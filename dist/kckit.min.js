"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define(t):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t():window[e]=t()}("KC",function(){var e={lang:"zh_cn",joint:"・",maxShipLv:165,maxHqLv:120,db:{},path:{db:"/kcdb/",pics:{ships:"/kcpic/ships/"}},statSpeed:{5:"低速",10:"高速",15:"高速+",20:"最速"},getStatSpeed:function(e){return this.statSpeed[parseInt(e)]},statRange:{1:"短",2:"中",3:"长",4:"超长"},getStatRange:function(e){return this.statRange[parseInt(e)]},textRank:{1:"|",2:"||",3:"|||",4:"\\",5:"\\\\",6:"\\\\\\",7:"》"}},t=function(){function t(e){_classCallCheck(this,t);for(var r in e)this[r]=e[r]}return _createClass(t,[{key:"getName",value:function(t){return t=t||e.lang,this.name?this.name[t]||this.name:null}},{key:"isName",value:function(t,r){if(r===!0&&(r=e.lang),r)return this.name[r]===t;for(var a in this.name)if("suffix"!==a&&this.name[a]===t)return!0;return!1}},{key:"hasName",value:function(t,r){if(r===!0&&(r=e.lang),r)return!!this.name[r].includes(t);for(var a in this.name)if("suffix"!==a&&this.name[a].includes(t))return!0;return!1}},{key:"isNameOf",value:function(){return this.hasName.apply(this,arguments)}},{key:"_name",get:function(){return this.getName()}}]),t}(),r=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),t}(t),a=function(r){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return Object.defineProperty(t,"rankupgradable",{value:t.isRankUpgradable()}),t}return _inherits(a,r),_createClass(a,[{key:"getName",value:function(r,a){a=a||e.lang;var i=t.prototype.getName.call(this,a),n=r&&!r==!0?r:"small";return r?i.replace(/（([^（^）]+)）/g,"<"+n+">($1)</"+n+">"):i}},{key:"getType",value:function(t){return t=t||e.lang,this.type?e.db.item_types[this.type].name[t]:null}},{key:"getIconId",value:function(){return Array.isArray(this.type_ingame)&&this.type_ingame.length>3?this.type_ingame[3]:e.db.item_types[this.type].icon}},{key:"getCaliber",value:function(){var e=this.getName(!1,"ja_jp"),t=parseFloat(e);return t}},{key:"getPower",value:function(){return this.stat[e.db.item_types[this.type].main_attribute||"fire"]}},{key:"isEquipableExSlot",value:function(){return this.equipable_exslot?this.equipable_exslot||!1:!!this.type&&(e.db.item_types[this.type].equipable_exslot||!1)}},{key:"isRankUpgradable",value:function(){return l.equipmentType.Aircrafts.includes(this.type)&&this.type!==l.equipmentType.Autogyro&&this.type!==l.equipmentType.AntiSubPatrol}},{key:"getStat",value:function(t,r){t=t.toLowerCase();var a=this.stat[t]||void 0;if(!r||void 0===a||!Array.isArray(this.stat_bonus))return a;if(r&&Array.isArray(this.stat_bonus)){"object"!==("undefined"==typeof r?"undefined":_typeof(r))&&(r=e.db.ships[r]);var i=r.id,n=void 0;if(this.stat_bonus.some(function(e){return Array.isArray(e.ships)&&e.ships.some(function(t){return t==i&&(n=e.bonus,!0)}),Array.isArray(e.ship_classes)&&e.ship_classes.some(function(t){return t==r["class"]&&(n=e.bonus,!0)}),"undefined"!=typeof n}),n)return a+(n[t]||0)}return a}},{key:"_icon",get:function(){return"assets/images/itemicon/"+this.getIconId()+".png"}}]),a}(t),i=function(t){function r(e){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e))}return _inherits(r,t),_createClass(r,[{key:"getName",value:function(t,r){t=t||"",r=r||e.lang;var a=this.getSuffix(r);return(this.name[r]||this.name.ja_jp)+(a?(t===!0?e.joint:t)+a:"")}},{key:"getNameNoSuffix",value:function(t){return t=t||e.lang,this.name[t]||this.name.ja_jp}},{key:"getSuffix",value:function(t){return t=t||e.lang,this.name.suffix?e.db.ship_namesuffix[this.name.suffix][t]||e.db.ship_namesuffix[this.name.suffix].ja_jp||"":""}},{key:"getType",value:function(t){return t=t||e.lang,this.type?e.db.ship_types[this.type].name[t]||e.db.ship_types[this.type].name.ja_jp||"":null}},{key:"getSeriesData",value:function(){return this.series?e.db.ship_series[this.series].ships:[{id:this.id}]}},{key:"getPic",value:function(t,r){var a=this.getSeriesData();t=parseInt(t||0);for(var i=function(t,a){return"undefined"!=typeof node&&node&&node.path&&e.path.pics.ships?node.path.join(e.path.pics.ships,t+"/"+a+"."+(r?r:"webp")):e.path.pics.ships?e.path.pics.ships+t+"/"+a+"."+(r?r:"png"):"/"+t+"/"+a+"."+(r?r:"png")},n=0;n<a.length;n++)if(a[n].id==this.id)switch(t){case 0:case 1:case 2:case 3:case 12:case 13:case 14:return i(this.id,t);default:return a[n].illust_delete?i(a[n-1].id,t):i(this.id,t)}}},{key:"getSpeed",value:function(){return e.statSpeed[parseInt(this.stat.speed)]}},{key:"getSpeedRule",value:function(){return this.speed_rule?this.speed_rule:this["class"]?e.db.ship_classes[this["class"]].speed_rule:null}},{key:"getRange",value:function(){return e.statRange[parseInt(this.stat.range)]}},{key:"getEquipmentTypes",value:function(){var t=this.additional_disable_item_types||[];return e.db.ship_types[this.type].equipable.concat(this.additional_item_types||[]).filter(function(e){return t.indexOf(e)<0}).sort(function(e,t){return e-t})}},{key:"getAttribute",value:function(t,a){a=a||1,a>r.lvlMax&&(a=r.lvlMax);var i=function(e,t,r){return e=e||1,t=parseFloat(t),r=parseFloat(r)||t,t<0||r<0?-1:t==r?r:Math.floor(t+(r-t)*e/99)},n=void 0;switch(t){case"hp":return n=this.stat.hp,a>99&&(n=this.stat.hp>=90?this.stat.hp+9:this.stat.hp>=70?this.stat.hp+8:this.stat.hp>=50?this.stat.hp+7:this.stat.hp>=40?this.stat.hp+6:this.stat.hp>=30?this.stat.hp+5:this.stat.hp+4,n>this.stat.hp_max&&(n=this.stat.hp_max)),n;case"speed":return e.getStatSpeed(this.stat.speed);case"range":return e.getStatRange(this.stat.range);case"luck":return a>99?this.stat.luck+3:this.stat.luck;case"fuel":case"ammo":return a>99?Math.floor(.85*this.consum[t]):this.consum[t];case"aa":case"armor":case"fire":case"torpedo":return this.stat[t+"_max"]||this.stat[t];default:return i(a,this.stat[t],this.stat[t+"_max"])}}},{key:"getRel",value:function(t){if(t){if(!this.rels[t]&&this.remodel&&this.remodel.prev)for(var r=e.db.ships[this.remodel.prev];r;){if(r.rels&&r.rels[t])return r.rels[t];r=r.remodel&&r.remodel.prev?e.db.ships[r.remodel.prev]:null}return this.rels[t]}return this.rels}},{key:"getCV",value:function(t){var r=this.getRel("cv");if(r)return e.db.entities[r].getName(t||e.lang)}},{key:"getIllustrator",value:function(t){var r=this.getRel("illustrator");if(r)return e.db.entities[r].getName(t||e.lang)}},{key:"getMinLv",value:function(){var e=this,t=this._series,r=void 0;return t.some(function(a,i){return e.id==a.id&&(r=i?t[i-1].next_lvl:1),r}),r}},{key:"getNavy",value:function(){return this.navy?this.navy:this["class"]?e.db.ship_classes[this["class"]].navy||"ijn":"ijn"}},{key:"getCapability",value:function(e){if(!e)return this.capabilities||{};if(this.capabilities)return this.capabilities[e]}},{key:"getStatExtraMax",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(e.toLowerCase()){case"hp":var r=this.getAttribute(e,t),a=this.stat.hp_max;return Math.max(0,Math.min(2,a-r));case"asw":return!!this.stat.asw&&9;default:return!1}}},{key:"_type",get:function(){return this.getType()}},{key:"_series",get:function(){return this.getSeriesData()}},{key:"_pics",get:function(){for(var e=[],t=0;t<15;t++)e.push(this.getPic(t));return e}},{key:"_speed",get:function(){return this.getSpeed()}},{key:"_speedRule",get:function(){return this.getSpeedRule()}},{key:"_range",get:function(){return this.getRange()}},{key:"_cv",get:function(){return this.getCV()}},{key:"_illustrator",get:function(){return this.getIllustrator()}},{key:"_minLv",get:function(){return this.getMinLv()}},{key:"_navy",get:function(){return this.getNavy()}}]),r}(t);i.lvlMax=e.maxShipLv;var n=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),t}(t);e.dbLoad=function(t){return"string"==typeof t?e.dbLoad({type:t}):t.type||t.url?$.ajax({url:t.url||e.path.db+"/"+t.type+".json",dataType:"text",success:function(n){var s=[];t.beforeProcess&&(s=t.beforeProcess(n)),"undefined"==typeof e.db[t.type]&&(e.db[t.type]={}),s.forEach(function(n){if(n){var s=JSON.parse(n);switch(t.type){case"ships":e.db[t.type][s.id]=new i(s);break;case"items":e.db[t.type][s.id]=new a(s);break;case"entities":e.db[t.type][s.id]=new r(s);break;default:e.db[t.type][s.id]=s}}}),t.success&&t.success(n)},complete:function(e,r){t.complete&&t.complete(e,r)}}):null};var s=function(t){return t instanceof i?t:e.db.ships?e.db.ships[t]:{}},o=function(t){return t instanceof a?t:e.db.equipments?e.db.equipments[t]:e.db.items[t]},c=function(e){var t=e.map(function(e){return e});return t[4]=0,t},l={equipmentType:{SmallCaliber:1,SmallCaliberHigh:2,SmallCaliberAA:3,MediumCaliber:4,LargeCaliber:5,SuperCaliber:6,SecondaryGun:7,SecondaryGunHigh:8,SecondaryGunAA:9,APShell:11,Torpedo:12,SubmarineTorpedo:13,MidgetSubmarine:14,ReconSeaplane:15,ReconSeaplaneNight:16,SeaplaneBomber:17,CarrierFighter:18,TorpedoBomber:19,DiveBomber:20,CarrierRecon:21,Autogyro:22,AntiSubPatrol:23,SmallRadar:24,LargeRadar:25,DepthCharge:26,Sonar:27,LargeSonar:28,AAGun:29,AAGunConcentrated:30,AAFireDirector:31,AviationPersonnel:36,SurfaceShipPersonnel:37,LandingCraft:38,Searchlight:39,CommandFacility:45,LargeFlyingBoat:45,SearchlightLarge:46,SuparRadar:47,CarrierRecon2:50,SeaplaneFighter:51,AmphibiousCraft:52,LandBasedAttacker:53,Interceptor:54,JetBomberFighter:55,JetBomberFighter2:56,TransportMaterial:57,SubmarineEquipment:58,LandBasedFighter:59,CarrierFighterNight:60,TorpedoBomberNight:61,LandBasedAntiSubPatrol:62},shipType:{Carriers:[9,10,11,30,32],LightCruisers:[2,3,21,28],Destroyers:[1,19],Submarines:[13,14]},calcByShip:{},calcByFleet:{},calcByField:{},calc:{}},h=l.equipmentType;return h.MainGuns=[h.SmallCaliber,h.SmallCaliberHigh,h.SmallCaliberAA,h.MediumCaliber,h.LargeCaliber,h.SuperCaliber],h.SmallCalibers=[h.SmallCaliber,h.SmallCaliberHigh,h.SmallCaliberAA],h.MediumCalibers=[h.MediumCaliber],h.LargeCalibers=[h.LargeCaliber,h.SuperCaliber],h.SecondaryGuns=[h.SecondaryGun,h.SecondaryGunHigh,h.SecondaryGunAA],h.APShells=[h.APShell],h.Torpedos=[h.Torpedo,h.SubmarineTorpedo],h.Seaplanes=[h.ReconSeaplane,h.ReconSeaplaneNight,h.SeaplaneBomber,h.SeaplaneFighter],h.Fighters=[h.SeaplaneBomber,h.CarrierFighter,h.CarrierFighterNight,h.TorpedoBomber,h.TorpedoBomberNight,h.DiveBomber,h.SeaplaneFighter,h.LandBasedAttacker,h.Interceptor,h.JetBomberFighter,h.JetBomberFighter2,h.LandBasedFighter],h.Interceptors=[h.Interceptor,h.LandBasedFighter],h.Recons=[h.ReconSeaplane,h.ReconSeaplaneNight,h.CarrierRecon,h.CarrierRecon2,h.LargeFlyingBoat],h.ReconSeaplanes=[h.ReconSeaplane,h.ReconSeaplaneNight],h.SeaplaneRecons=[h.ReconSeaplane,h.ReconSeaplaneNight,h.LargeFlyingBoat],h.SeaplaneBombers=[h.SeaplaneBomber,h.SeaplaneFighter],h.SeaplaneFighters=[h.SeaplaneFighter],h.CarrierFighters=[h.CarrierFighter,h.CarrierFighterNight],h.CarrierRecons=[h.CarrierRecon,h.CarrierRecon2],h.CarrierBased=[h.CarrierFighter,h.CarrierFighterNight,h.TorpedoBomber,h.TorpedoBomberNight,h.DiveBomber,h.CarrierRecon,h.CarrierRecon2,h.JetBomberFighter,h.JetBomberFighter2],h.LandBased=[h.LandBasedAttacker,h.Interceptor,h.JetBomberFighter,h.JetBomberFighter2,h.LandBasedFighter,h.LandBasedAntiSubPatrol],h.TorpedoBombers=[h.TorpedoBomber,h.TorpedoBomberNight],h.DiveBombers=[h.DiveBomber],h.JetBomberFighters=[h.JetBomberFighter,h.JetBomberFighter2],h.Autogyros=[h.Autogyro],h.AntiSubPatrols=[h.AntiSubPatrol,h.LandBasedAntiSubPatrol],h.Aircrafts=[],[].concat(h.Seaplanes).concat(h.Recons).concat(h.CarrierBased).concat(h.Autogyros).concat(h.AntiSubPatrols).concat(h.LandBased).forEach(function(e){h.Aircrafts.indexOf(e)<0&&h.Aircrafts.push(e)}),h.Radars=[h.SmallRadar,h.LargeRadar,h.SuparRadar],h.SmallRadars=[h.SmallRadar],h.LargeRadars=[h.LargeRadar,h.SuparRadar],h.AntiSubmarines=[h.DepthCharge,h.Sonar,h.LargeSonar],h.DepthCharges=[h.DepthCharge],h.Sonars=[h.Sonar,h.LargeSonar],h.AAGuns=[h.AAGun,h.AAGunConcentrated],h.AAFireDirectors=[h.AAFireDirector],h.Searchlights=[h.Searchlight,h.SearchlightLarge],h.AviationPersonnels=[h.AviationPersonnel],h.SurfaceShipPersonnels=[h.SurfaceShipPersonnel],h.LandingCrafts=[h.LandingCraft,h.AmphibiousCraft],h.AmphibiousCrafts=[h.AmphibiousCraft],h.isInterceptor=function(e){return e=o(e),(!e.type_ingame||47!=e.type_ingame[2])&&h.Interceptors.indexOf(e.type)>-1},l.starMultiper={SmallCalibers:{shelling:1,night:1},MediumCalibers:{shelling:1,night:1},LargeCalibers:{shelling:1.5,night:1},SecondaryGuns:{shelling:1,night:1},APShells:{shelling:1,night:1},AAFireDirectors:{shelling:1,night:1},Searchlights:{shelling:1,night:1},AAGuns:{shelling:1,torpedo:1.2},Torpedos:{torpedo:1.2,night:1},DepthCharges:{shelling:.75,antisub:1},Sonars:{shelling:.75,antisub:1},SmallRadars:{los:1.25},LargeRadars:{los:1.4},Seaplanes:{},ReconSeaplanes:{los:1.2},SeaplaneFighters:{fighter:.2},SeaplaneBomber:{los:1.15},CarrierFighters:{fighter:.2},DiveBombers:{fighter:.25,night:1},CarrierRecons:{los:1.2},LandingCrafts:{shelling:1,night:1},Interceptors:{fighter:.2}},l.getStarMultiper=function(e,t){if(!l.starMultiper._init){var r=function(e){h[e]&&h[e].forEach?h[e].forEach(function(t){l.starMultiper[t]=l.starMultiper[e]}):"number"==typeof h[e]&&(l.starMultiper[h[e]]=l.starMultiper[e])};for(var a in l.starMultiper)r(a);l.starMultiper._init=!0}return l.starMultiper[e]?l.starMultiper[e][t]||0:0},l.getFighterPowerRankMultiper=function(e,t){e=o(e);var r=[],a={};r[0]=[0,9],r[1]=[10,24],r[2]=[25,39],r[3]=[40,54],r[4]=[55,69],r[5]=[70,84],r[6]=[85,99],r[7]=[100,120],a.CarrierFighter=[0,0,2,5,9,14,14,22],a.SeaplaneBomber=[0,0,1,1,1,3,3,6];var i=r[t],n=0;switch(e.type){case h.CarrierFighter:case h.CarrierFighterNight:case h.Interceptor:case h.SeaplaneFighter:case h.LandBasedFighter:n=a.CarrierFighter[t];break;case h.SeaplaneBomber:n=a.SeaplaneBomber[t]}return{min:Math.sqrt(i[0]/10)+n,max:Math.sqrt(i[1]/10)+n}},l.calculate=function(t,r,n,s,o,p){if(!t||!r)return 0;r instanceof i||(r=e.db.ships[r]);var u=0,d={main:0,secondary:0,torpedo:0,torpedoLateModel:0,seaplane:0,apshell:0,radar:0,radarAA:0,radarSurface:0,submarineEquipment:0,carrierFighterNight:0,torpedoBomberNight:0,aviationPersonnelNight:0,surfaceShipPersonnel:0},f=c(r.slot),g=function(e){return l.calcByShip.torpedoPower(r,n,s,o,e)},m=0;switch(n=n.map(function(t){return t?t instanceof a?t:e.db.equipments?e.db.equipments[t]:e.db.items[t]:null})||[],s=s||[],o=o||[],p=p||{},n.forEach(function(e){e&&(h.MainGuns.indexOf(e.type)>-1?d.main+=1:h.SecondaryGuns.indexOf(e.type)>-1?d.secondary+=1:h.Torpedos.indexOf(e.type)>-1?(d.torpedo+=1,e.name.ja_jp.indexOf("後期型")>-1&&(d.torpedoLateModel+=1)):h.Seaplanes.indexOf(e.type)>-1?d.seaplane+=1:h.APShells.indexOf(e.type)>-1?d.apshell+=1:h.Radars.indexOf(e.type)>-1?(d.radar+=1,e.stat.aa&&(d.radarAA+=1),e.stat.hit&&e.stat.hit>=3&&(d.radarSurface+=1)):h.SubmarineEquipment==e.type?d.submarineEquipment+=1:h.AviationPersonnels.indexOf(e.type)>-1?e.name.ja_jp.indexOf("夜間")>-1&&(d.aviationPersonnelNight+=1):h.SurfaceShipPersonnels.indexOf(e.type)>-1&&(d.surfaceShipPersonnel+=1),e.type_ingame&&(45===e.type_ingame[3]?d.carrierFighterNight+=1:46===e.type_ingame[3]&&(d.torpedoBomberNight+=1)))}),t){case"fighterPower":return m=0,f.map(function(e,t){if(n[t]&&h.Fighters.indexOf(n[t].type)>-1&&e){if(m=Math.sqrt(e)*(n[t].getStat("aa",r)||0),h.CarrierFighters.includes(n[t].type))switch(o[t]){case 1:case"1":m+=1;break;case 2:case"2":m+=4;break;case 3:case"3":m+=6;break;case 4:case"4":m+=11;break;case 5:case"5":m+=16;break;case 6:case"6":m+=17;break;case 7:case"7":m+=25}else if(h.Recons.indexOf(n[t].type)==-1){var a=n[t].type==h.SeaplaneBomber?9:3;m+=1==o[t]?1:a/6*(o[t]-1)}u+=Math.floor(m)}}),u;case"fighterPower_v2":return l.calcByShip.fighterPower_v2(r,n,s,o);case"shelling":case"shellingDamage":return l.shipType.Submarines.indexOf(r.type)>-1?"-":(u=l.calcByShip.shellingPower(r,n,s,o),u&&u>-1?Math.floor(u):"-");case"torpedo":case"torpedoDamage":return u=g(),u&&u>-1?Math.floor(u):"-";case"nightBattle":var b=l.calcByShip.nightPower(r,n,s,o,{},d);return b.damage<=0?"-":b.value;case"addHit":return f.map(function(e,t){n[t]&&(u+=n[t].getStat("hit",r)||0)}),u>=0?"+"+u:u;case"addArmor":return f.map(function(e,t){n[t]&&(u+=n[t].getStat("armor",r)||0)}),u;case"addEvasion":return f.map(function(e,t){n[t]&&(u+=n[t].getStat("evasion",r)||0)}),u;case"losPower":return l.calcByShip.losPower(r,n,s,o,p);default:return l.calcByShip[t](r,n,s,o,p)}},l.shellingDamage=function(e,t,r,a){return this.calculate("shellingDamage",e,t,r,a)},l.torpedoDamage=function(e,t,r,a){return this.calculate("torpedoDamage",e,t,r,a)},l.fighterPower=function(e,t,r,a){return this.calculate("fighterPower",e,t,r,a)},l.fighterPower_v2=function(e,t,r,a){return this.calculate("fighterPower_v2",e,t,r,a)},l.nightBattle=function(e,t,r,a){return this.calculate("nightBattle",e,t,r,a)},l.addHit=function(e,t,r,a){return this.calculate("addHit",e,t,r,a)},l.addArmor=function(e,t,r,a){return this.calculate("addArmor",e,t,r,a)},l.addEvasion=function(e,t,r,a){return this.calculate("addEvasion",e,t,r,a)},l.losPower=function(e,t,r,a,i){return this.calculate("losPower",e,t,r,a,i)},l.calc.losPower=function(e){var t=function(e){"undefined"==typeof e["(Intercept)"]&&(e["(Intercept)"]=1),e.hqLv=5*Math.ceil(e.hqLv/5);var t={},s=0,o={},c=0;return r.forEach(function(r){var n=e[r]*a[r];t[r]=n,s+=n,o[r]=e[r]*i[r]}),r.forEach(function(e){r.forEach(function(t){c+=o[e]*o[t]*n[e][t]})}),{x_estimate:t,y_estimate:s,x_std_error:o,y_std_error:c}},r=["(Intercept)","DiveBombers","TorpedoBombers","CarrierRecons","SeaplaneRecons","SeaplaneBombers","SmallRadars","LargeRadars","Searchlights","statLos","hqLv"],a={"(Intercept)":0,DiveBombers:1.03745043134563,TorpedoBombers:1.3679056374142,CarrierRecons:1.65940512636315,SeaplaneRecons:2,SeaplaneBombers:1.77886368594467,SmallRadars:1.0045778494921,LargeRadars:.990738063979571,Searchlights:.906965144360512,statLos:1.6841895400986,hqLv:-.614246711531445},i={"(Intercept)":4.66445565766347,DiveBombers:.0965028505325845,TorpedoBombers:.108636184978525,CarrierRecons:.0976055279516298,SeaplaneRecons:.0866229392463539,SeaplaneBombers:.0917722496848294,SmallRadars:.0492773648320346,LargeRadars:.0491221486053861,Searchlights:.0658283797225724,statLos:.0781594211213618,hqLv:.0369222352426548},n={"(Intercept)":{"(Intercept)":1,DiveBombers:-.147020064768061,TorpedoBombers:-.379236131621529,CarrierRecons:-.572858669501918,SeaplaneRecons:-.733913857017495,SeaplaneBombers:-.642621825152428,SmallRadars:-.674829588068364,LargeRadars:-.707418111752863,Searchlights:-.502304601556193,statLos:-.737374218573832,hqLv:-.05071933950163},DiveBombers:{"(Intercept)":-.147020064768061,DiveBombers:1,TorpedoBombers:.288506347076736,CarrierRecons:.365820372770994,SeaplaneRecons:.425744409856409,SeaplaneBombers:.417783698791503,SmallRadars:.409046013184429,LargeRadars:.413855653833994,Searchlights:.308730607324667,statLos:.317984916914851,hqLv:-.386740224500626},TorpedoBombers:{"(Intercept)":-.379236131621529,DiveBombers:.288506347076736,TorpedoBombers:1,CarrierRecons:.482215071254241,SeaplaneRecons:.584455876852325,SeaplaneBombers:.558515133495825,SmallRadars:.547260012897553,LargeRadars:.560437619378443,Searchlights:.437934879351188,statLos:.533934507932748,hqLv:-.405349979885748},CarrierRecons:{"(Intercept)":-.572858669501918,DiveBombers:.365820372770994,TorpedoBombers:.482215071254241,CarrierRecons:1,SeaplaneRecons:.804494553748065,SeaplaneBombers:.75671307047535,SmallRadars:.748420581669228,LargeRadars:.767980338133817,Searchlights:.589651513349878,statLos:.743851348255527,hqLv:-.503544281376776},SeaplaneRecons:{"(Intercept)":-.733913857017495,DiveBombers:.425744409856409,TorpedoBombers:.584455876852325,CarrierRecons:.804494553748065,SeaplaneRecons:1,SeaplaneBombers:.932444440578382,SmallRadars:.923988080549326,LargeRadars:.94904944359066,Searchlights:.727912987329348,statLos:.944434077970518,hqLv:-.614921413821462},SeaplaneBombers:{"(Intercept)":-.642621825152428,DiveBombers:.417783698791503,TorpedoBombers:.558515133495825,CarrierRecons:.75671307047535,SeaplaneRecons:.932444440578382,SeaplaneBombers:1,SmallRadars:.864289865445084,LargeRadars:.886872388674911,Searchlights:.68310647756898,statLos:.88122333327317,hqLv:-.624797255805045},SmallRadars:{"(Intercept)":-.674829588068364,DiveBombers:.409046013184429,TorpedoBombers:.547260012897553,CarrierRecons:.748420581669228,SeaplaneRecons:.923988080549326,SeaplaneBombers:.864289865445084,SmallRadars:1,LargeRadars:.872011318623459,Searchlights:.671926570242336,statLos:.857213501657084,hqLv:-.560018086758868},LargeRadars:{"(Intercept)":-.707418111752863,DiveBombers:.413855653833994,TorpedoBombers:.560437619378443,CarrierRecons:.767980338133817,SeaplaneRecons:.94904944359066,SeaplaneBombers:.886872388674911,SmallRadars:.872011318623459,LargeRadars:1,Searchlights:.690102027588321,statLos:.883771367337743,hqLv:-.561336967269448},Searchlights:{"(Intercept)":-.502304601556193,DiveBombers:.308730607324667,TorpedoBombers:.437934879351188,CarrierRecons:.589651513349878,SeaplaneRecons:.727912987329348,SeaplaneBombers:.68310647756898,SmallRadars:.671926570242336,LargeRadars:.690102027588321,Searchlights:1,statLos:.723228553177704,hqLv:-.518427865593732},statLos:{"(Intercept)":-.737374218573832,DiveBombers:.317984916914851,TorpedoBombers:.533934507932748,CarrierRecons:.743851348255527,SeaplaneRecons:.944434077970518,SeaplaneBombers:.88122333327317,SmallRadars:.857213501657084,LargeRadars:.883771367337743,Searchlights:.723228553177704,statLos:1,hqLv:-.620804120587684},hqLv:{"(Intercept)":-.05071933950163,DiveBombers:-.386740224500626,TorpedoBombers:-.405349979885748,CarrierRecons:-.503544281376776,SeaplaneRecons:-.614921413821462,SeaplaneBombers:-.624797255805045,SmallRadars:-.560018086758868,LargeRadars:-.561336967269448,Searchlights:-.518427865593732,statLos:-.620804120587684,hqLv:1}},s={DiveBombers:0,TorpedoBombers:0,CarrierRecons:0,SeaplaneRecons:0,SeaplaneBombers:0,SmallRadars:0,LargeRadars:0,Searchlights:0,statLos:1,hqLv:1};for(var o in e)s[o]=e[o];return t(s)},l.calc.los33=function(e){if(e){var t=0,r=0,a={TorpedoBombers:.8,CarrierRecons:1,ReconSeaplane:1.2,ReconSeaplaneNight:1.2,SeaplaneBomber:1.1};return Object.defineProperty(a,"default",{value:.6,enumerable:!1,configurable:!1,writable:!1}),e.equipments.forEach(function(e){if(e.id){var r=o(e.id);if(r.stat.los){var i=a["default"],n=e.star||0;for(var s in a){var c=[];c=Array.isArray(h[s])?h[s]:[h[s]],c.indexOf(r.type)>-1&&(i=a[s])}t+=i*(r.stat.los+l.getStarMultiper(r.type,"los")*Math.sqrt(n))}}}),e.ships.forEach(function(e){var t=s(e.id),a=t.getAttribute("los",Math.max(e.lv||1,t.getMinLv()));r+=Math.sqrt(Math.max(a,1))}),t+r-Math.ceil(.4*e.hq)+2*(6-e.ships.length)}},l.calc.TP=function(e){e=e||{};var t=0,r=e.ship||{},a=e.equipment||{};for(var i in r){var n=0;switch(i){case 1:case"1":case 19:case"19":case"dd":n=5;break;case 2:case"2":case 28:case"28":case"cl":n=2;break;case 21:case"21":case"ct":n=6;break;case 5:case"5":case"cav":n=4;break;case 8:case"8":case"bbv":n=7;break;case 12:case"12":case 24:case"24":case"av":n=9.5;break;case 14:case"14":case"ssv":n=1;break;case 15:case"15":case"lha":n=12;break;case 29:case"29":case"ao":n=15;break;case 17:case"17":case"as":n=7}t+=n*(parseInt(r[i])||0)}for(var s in a){var c=0,h=parseInt(s),p=void 0;switch(h){case 145:c=1;break;case 150:c=1;break;case 75:c=5;break;case 68:c=8;break;case 193:c=8;break;case 166:c=8;break;case 167:c=2;break;default:switch(p=o(h),p.type){case l.equipmentType.LandingCraft:p.name.ja_jp.indexOf("大発動艇")>-1&&(c=8)}}t+=c*(parseInt(a[s])||0)}return t},l.calc.fighterPower=function(t,r,i,n){if(!t)return[0,0];t=t instanceof a?t:e.db.equipments?e.db.equipments[t]:e.db.items[t],r=r||0,i=i||0,n=n||0;var s=[0,0];if(h.Fighters.indexOf(t.type)>-1&&r){var o=(t.stat.aa||0)+(h.isInterceptor(t)?1.5*t.stat.evasion:0)+n*l.getStarMultiper(t.type,"fighter"),c=o*Math.sqrt(r),p=l.getFighterPowerRankMultiper(t,i);s[0]+=Math.floor(c+p.min),s[1]+=Math.floor(c+p.max)}return s},l.calc.fighterPowerAA=function(e,t,r,a){if(!e)return[0,0];e=o(e),t=t||0,r=r||0,a=a||0;var i=[0,0];if(t){var n=(e.stat.aa||0)+(h.isInterceptor(e)?e.stat.evasion:0)+(h.isInterceptor(e)?2*e.stat.hit:0)+a*l.getStarMultiper(e.type,"fighter"),s=n*Math.sqrt(t),c=l.getFighterPowerRankMultiper(e,r,{isAA:!0});i[0]+=Math.floor(s+c.min),i[1]+=Math.floor(s+c.max)}return i},l.calcByShip.shellingPower=function(e,t,r,a,i){i=i||{};var n=0,s=!1,o=c(e.slot);if(l.shipType.Carriers.indexOf(e.type)>-1?s=!0:t.some(function(e){if(e&&!s&&h.CarrierBased.indexOf(e.type)>-1)return s=!0,!0}),s&&!i.isNight){var p=0,u=0;return o.map(function(a,i){if(t[i]){var s=t[i];n+=1.5*s.getStat("fire",e)||0,h.TorpedoBombers.indexOf(s.type)>-1&&(p+=s.getStat("torpedo",e)||0),u+=s.getStat("bomb",e)||0,h.SecondaryGuns.indexOf(s.type)>-1&&(n+=Math.sqrt(1.5*(r[i]||0)))}}),p||u?n+=Math.floor(1.5*(Math.floor(1.3*u)+p+e.stat.fire_max))+50:-1}n=e.stat.fire_max||0;var d=0,f=0;return o.map(function(a,s){if(t[s]){var o=t[s];n+=o.getStat("fire",e)||0,l.shipType.LightCruisers.indexOf(e.type)>-1&&(4==o.id&&(d+=1),119!=o.id&&65!=o.id&&139!=o.id||(f+=1)),r[s]&&!i.isNight&&(n+=Math.sqrt(r[s])*l.getStarMultiper(o.type,"shelling"))}}),n+2*Math.sqrt(f)+Math.sqrt(d)},l.calcByShip.torpedoPower=function(e,t,r,a,i){i=i||{};var n=0,s=c(e.slot);return l.shipType.Carriers.indexOf(e.type)>-1&&!i.isNight?i.returnZero?0:-1:(n=e.stat.torpedo_max||0,s.map(function(a,s){if(t[s]){var o=t[s];n+=h.TorpedoBombers.indexOf(o.type)>-1&&!i.isNight?0:o.getStat("torpedo",e)||0,r[s]&&!i.isNight&&(n+=Math.sqrt(r[s])*l.getStarMultiper(o.type,"torpedo"))}}),n)},l.calcByShip.nightPower=function(e,t,r,a,i,n){i=i||{};var s={damage:0},o=0,p=c(e.slot);if((n.aviationPersonnelNight||e.getCapability("count_as_night_operation_aviation_personnel"))&&(n.carrierFighterNight>=1||n.torpedoBomberNight>=1)){p.forEach(function(e,a){t[a]&&r[a]&&(o+=Math.sqrt(r[a])*l.getStarMultiper(t[a].type,"night"))});var u=0,d=0,f=0,g=0,m=0,b=[],y=0,S=0;p.forEach(function(a,i){if(t[i]){var n=t[i],s=!1,o=!1;n.type_ingame&&(45===n.type_ingame[3]?(o=!0,s=!0):46===n.type_ingame[3]&&(o=!0,s=!0)),h.TorpedoBombers.indexOf(n.type)>-1?n.hasName("Swordfish","ja_jp")&&(o=!0,y++):h.DiveBombers.indexOf(n.type)>-1&&n.hasName("岩井","ja_jp")&&(o=!0,S++),s&&(u+=a),o&&(d+=n.getStat("fire",e),f+=n.getStat("torpedo",e),g+=Math.sqrt(a)*((3+1.5*(s?1:0))*(n.getStat("fire",e)+n.getStat("torpedo",e)+n.getStat("bomb",e)+n.getStat("asw",e))/10),r[i]&&(m+=Math.sqrt(r[i])*l.getStarMultiper(t[i].type,"night")))}});var v=y+S;n.carrierFighterNight>=2&&n.torpedoBomberNight>=1&&b.push(1.25),n.carrierFighterNight>=1&&n.torpedoBomberNight>=1&&b.push(1.2),(n.carrierFighterNight>=3||n.carrierFighterNight>=2&&v>=1||n.carrierFighterNight>=1&&n.torpedoBomberNight>=1&&v>=1||n.carrierFighterNight>=1&&n.torpedoBomberNight>=2||n.carrierFighterNight>=1&&v>=2)&&b.push(1.18),s.type="航空",s.hit=1,s.damage=Math.floor(e.stat.fire_max+d+f+3*u+g+m),s.isMax=!0,b.length&&(s.cis=b.map(function(e){return[Math.floor(s.damage*e),1]}))}else if(e.getCapability("participate_night_battle_when_equip_swordfish"))s.damage+=e.stat.fire_max+e.stat.torpedo_max,p.forEach(function(r,a){var i=t[a];t[a]&&h.TorpedoBombers.indexOf(i.type)>-1&&i.name.ja_jp.indexOf("Swordfish")>-1&&(s.damage+=i.getStat("fire",e)+i.getStat("torpedo",e))}),s.type="通常",s.damage=Math.floor(s.damage),s.hit=1;else{if(e.stat.fire+e.stat.torpedo<=0)return{damage:0};var _={};p.forEach(function(e,a){if(t[a]&&(r[a]&&(o+=Math.sqrt(r[a])*l.getStarMultiper(t[a].type,"night")),t[a])){var i=t[a];_[i.id]?_[i.id]++:_[i.id]=1}}),s.damage=l.calcByShip.shellingPower(e,t,r,a,{isNight:!0})+l.calcByShip.torpedoPower(e,t,r,a,{isNight:!0,returnZero:!0})+o,l.shipType.Submarines.indexOf(e.type)>-1&&n.torpedoLateModel>=1&&n.submarineEquipment>=1?(s.type="雷击CI",s.damage=Math.floor(1.75*s.damage),s.hit=2):l.shipType.Submarines.indexOf(e.type)>-1&&n.torpedoLateModel>=2?(s.type="雷击CI",s.damage=Math.floor(1.6*s.damage),s.hit=2):n.torpedo>=2?(s.type="雷击CI",s.damage=Math.floor(1.5*s.damage),s.hit=2):n.main>=3?(s.type="炮击CI",s.damage=Math.floor(2*s.damage),s.hit=1):2==n.main&&n.secondary>=1?(s.type="炮击CI",s.damage=Math.floor(1.75*s.damage),s.hit=1):l.shipType.Destroyers.indexOf(e.type)>-1&&n.torpedo>=1&&n.radarSurface>=1&&n.surfaceShipPersonnel>=1?(s.type="电探CI",s.damage=Math.floor(1.25*s.damage),s.hit=1):l.shipType.Destroyers.indexOf(e.type)>-1&&n.torpedo>=1&&n.radarSurface>=1&&n.main>=1?(s.type="电雷CI",s.damage=_[267]?Math.floor(1.625*s.damage):Math.floor(1.3*s.damage),s.hit=1):n.main>=1&&1==n.torpedo?(s.type="炮雷CI",s.damage=Math.floor(1.3*s.damage),s.hit=2):2==n.main&&n.secondary<=0&&n.torpedo<=0||1==n.main&&n.secondary>=1&&n.torpedo<=0||0==n.main&&n.secondary>=2&&n.torpedo>=0?(s.type="连击",s.damage=Math.floor(1.2*s.damage),s.hit=2):(s.type="通常",s.damage=Math.floor(s.damage),s.hit=1)}var B=" ";if(s.isMax&&(B=" ≤ "),s.isMin&&(B=" ≥ "),s.value=""+s.type+B+s.damage,s.hit&&s.hit>1&&(s.value+=" x "+s.hit),Array.isArray(s.cis)&&s.cis.length)s.value+=" (CI"+B+s.cis.sort(function(e,t){return e[0]-t[0]}).map(function(e){return e[0]+(e[1]&&e[1]>1?" x "+e[1]:"")}).join(" 或 ")+")";else if(s.damage_ci){var R=s.hit_ci||s.hit||1;s.value+=" (CI"+B+s.damage_ci+")",R&&R>1&&(s.value+=" x "+R)}return s},l.calcByShip.fighterPower_v2=function(e,t,r,a){var i=[0,0],n=c(e.slot);return n.map(function(e,n){var s=l.calc.fighterPower(t[n],e,a[n]||0,r[n]||0);i[0]+=s[0],i[1]+=s[1]}),i},l.calcByShip.losPower=function(e,t,r,a,i){i=i||{},i.shipLv=i.shipLv||1,i.hqLv=i.hqLv||1,i.shipLv<0&&(i.shipLv=1),i.hqLv<0&&(i.hqLv=1);var n={DiveBombers:0,TorpedoBombers:0,CarrierRecons:0,SeaplaneRecons:0,SeaplaneBombers:0,SmallRadars:0,LargeRadars:0,Searchlights:0,statLos:Math.sqrt(e.getAttribute("los",i.shipLv)),hqLv:i.hqLv};return t.forEach(function(e){if(e)for(var t in n)h[t]&&h[t].push&&h[t].indexOf(e.type)>-1&&(n[t]+=e.stat.los)}),l.calc.losPower(n)},l.calcByShip.TP=function(e,t){if(!e||!t||!t.push)return 0;e=s(e);var r={ship:{},equipment:{}};r.ship[e.type]=1,t.forEach(function(e){if(e){var t="number"==typeof e?e:o(e).id;r.equipment[t]||(r.equipment[t]=0),r.equipment[t]++}});var a=e.getCapability("count_as_landing_craft");return a&&(r.equipment[68]||(r.equipment[68]=0),r.equipment[68]++),l.calc.TP(r)},l.calcByShip.speed=function(t,r,a,i,n){if(!t)return"";if("object"===("undefined"==typeof a?"undefined":_typeof(a))&&a.push)return l.calcByShip.speed(t,r,[],[],a);if("object"===("undefined"==typeof i?"undefined":_typeof(i))&&i.push)return l.calcByShip.speed(t,r,a,[],i);t=s(t),r=r||[],n=n||{};var c=parseInt(t.stat.speed),h=function(t){return t=Math.min(20,t||c),n.returnNumber?t:e.statSpeed[t]},p={33:0,34:0,87:0},u=t._speedRule||"low-2",d=0;if(r.forEach(function(e){if(e){var t="number"==typeof e?e:o(e).id;"undefined"!=typeof p[""+t]&&p[""+t]++}}),!p[33])return h();
switch(u){case"low-1":d=.3*Math.min(p[34],1)+.7*p[87];break;case"low-2":case"high-3":(p[34]||p[87])&&(d=Math.min(1,p[34]/3+.5*p[87]));break;case"low-3":case"high-4":(p[34]||p[87])&&(c+=5);break;case"high-1":d=.5*p[34]+1*p[87];break;case"high-2":d=.5*p[34]+.5*p[87]}return d>0&&d<1?c+=5:d>=1&&d<1.5?c+=10:d>=1.5&&(c+=15),h()},l.calcByShip.fireRange=function(t,r){if(!t)return"-";r=r||[];var a=parseInt(t.stat.range);return r.forEach(function(e){e&&(a=Math.max(a,o(e).stat.range||0))}),e.statRange[a]},l.calcByFleet.los33=function(e,t){var r=[],a=[];return e.forEach(function(e){var t=e[0];if(t){var i=e[2],n=e[3],s=e[4];a.push({id:t,lv:e[1][0]}),i.forEach(function(e,t){r.push({id:e,star:n[t],rank:s[t]})})}}),l.calc.los33({hq:t,equipments:r,ships:a})},l.calcByField.fighterPowerAA=function(e){function t(e){return a=Math.max(e,a)}var r=[0,0],a=1;return e.forEach(function(e){var a=o(e[0]||e.equipment||e.equipmentId),i=e[1]||e.star||0,n=e[2]||e.rank||0,s=e[3]||e.carry||0,c=l.calc.fighterPowerAA(a,s,n,i);switch(s||(s=l.equipmentType.Recons.indexOf(a.type)>-1?4:18),r[0]+=c[0],r[1]+=c[1],a.type){case h.CarrierRecon:case h.CarrierRecon2:t(a.stat.los<=7?1.2:a.stat.los>=9?1.3:1.25);break;case h.ReconSeaplane:case h.ReconSeaplaneNight:case h.LargeFlyingBoat:t(a.stat.los<=7?1.1:a.stat.los>=9?1.16:1.13)}}),r[0]=r[0]*a,r[1]=r[1]*a,r},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new TypeError('"this" is null or not defined');var a=Object(this),i=a.length>>>0;if(0===i)return-1;var n=+t||0;if(Math.abs(n)===1/0&&(n=0),n>=i)return-1;for(r=Math.max(n>=0?n:i-Math.abs(n),0);r<i;){if(r in a&&a[r]===e)return r;r++}return-1}),e.Entity=r,e.Equipment=a,e.Ship=i,e.Consumable=n,e.formula=l,e});