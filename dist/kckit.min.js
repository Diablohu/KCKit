!function(e){var r={};function t(a){if(r[a])return r[a].exports;var i=r[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(a,i,function(r){return e[r]}.bind(null,i));return a},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=12)}([function(e,r,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=t(3),n=t(6),s=t(1),o=s.ArrayOrItem,u=s.ArrayOrItemAll,c={isid:function(e,r){return o(r,function(r){return!isNaN(r)&&parseInt(r)===e.id})},isnotid:function(e,r){return u(r,function(r){return!isNaN(r)&&parseInt(r)!==e.id})},isname:function(e,r){return o(r,function(r){return e.isName(r)})},isnotname:function(e,r){return u(r,function(r){return!e.isName(r)})},isnameof:function(e,r){return o(r,function(r){return e.hasName(r)})},isnotnameof:function(e,r){return u(r,function(r){return!e.hasName(r)})},istype:function(e,r,t){return o(r,function(r){if(isNaN(r))return!1;if(parseInt(r)!==e.type)return!1;if("object"===(void 0===t?"undefined":a(t))&&t.hasStat){var i=!0;for(var n in t.hasStat)Array.isArray(t.hasStat[n])?(e.stat[n]<t.hasStat[n][0]&&(i=!1),e.stat[n]>t.hasStat[n][1]&&(i=!1)):e.stat[n]<t.hasStat[n]&&(i=!1);if(!i)return!1}return!0})},isnottype:function(e,r){return u(r,function(r){return!isNaN(r)&&parseInt(r)!==e.type})},isaaradar:function(e,r){return(this.istype(e,n.Radars)&&!isNaN(e.stat.aa)&&e.stat.aa>=1)===r},issurfaceradar:function(e,r){return(this.istype(e,n.Radars)&&!isNaN(e.stat.hit)&&e.stat.hit>=3)===r}};e.exports=function e(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("object"===(void 0===t?"undefined":a(t)))return e(r,0,0,t);if("object"===(void 0===s?"undefined":a(s)))return e(r,t,0,s);if(void 0===(r=i(r)))return!1;for(var u in o)if(void 0!==o[u]){var l=u.toLowerCase();if(["improve","improvement","star"].includes(l))return(parseInt(t||0)||0)>=parseInt(o[u]);if(c[l]){if(!c[l](r,o[u]))return!1}else if("is"===u.substr(0,2)){var p=u.substr(2);if("HAMountAAFD"===p)p="HAMountsAAFD";else if(p+"s"in n)p+="s";else if(!(p in n))return!1;var h="object"===a(o[u])&&!Array.isArray(o[u]),f=o[u]&&h?o[u]:void 0;if(!c[!0===o[u]||h?"istype":"isnottype"](r,n[p],f))return!1}}return!0}},function(e,r,t){"use strict";var a=t(9),i=t(8);e.exports={ArrayOrItem:a,ArrayOrItemAll:i}},function(e,r,t){"use strict";var a=t(4),i=t(1),n=i.ArrayOrItem,s=i.ArrayOrItemAll;e.exports=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===(e=a(e)))return!1;for(var t in r)if(void 0!==r[t]&&!o[t.toLowerCase()](e,r[t]))return!1;return!0};var o={isid:function(e,r){return n(r,function(r){return!isNaN(r)&&parseInt(r)===e.id})},isnotid:function(e,r){return s(r,function(r){return!isNaN(r)&&parseInt(r)!==e.id})},isname:function(e,r){return n(r,function(r){return e.isName(r)})},isnotname:function(e,r){return s(r,function(r){return!e.isName(r)})},istype:function(e,r){return n(r,function(r){return!isNaN(r)&&parseInt(r)===e.type})},isnottype:function(e,r){return s(r,function(r){return!isNaN(r)&&parseInt(r)!==e.type})},isbattleship:function(e,r){return this.istype(e,[8,6,20,7,18])===r},isbb:function(e,r){return this.isbattleship(e,r)},iscarrier:function(e,r){return this.istype(e,[11,10,9,30,32])===r},iscv:function(e,r){return this.iscarrier(e,r)},issubmarine:function(e,r){return this.istype(e,[14,13])===r},isss:function(e,r){return this.issubmarine(e,r)},isclass:function(e,r){return n(r,function(r){return!isNaN(r)&&parseInt(r)===e.class})},isnotclass:function(e,r){return s(r,function(r){return!isNaN(r)&&parseInt(r)!==e.class})},hasslot:function(e,r){return!!Array.isArray(e.slot)&&(Array.isArray(r)?isNaN(r[0])&&!isNaN(r[1])?e.slot.length<=parseInt(r[1]):!isNaN(r[0])&&isNaN(r[1])?e.slot.length>=parseInt(r[0]):!isNaN(r[0])&&!isNaN(r[1])&&(e.slot.length>=parseInt(r[0])&&e.slot.length<=parseInt(r[1])):!isNaN(r)&&parseInt(r)===e.slot.length)},hasslotmin:function(e,r){return this.hasslot(e,[r,void 0])},hasslotmax:function(e,r){return this.hasslot(e,[void 0,r])},minlevel:function(e,r){return void 0===e.level||e.level>=r}}},function(e,r,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return e&&"object"===(void 0===e?"undefined":a(e))&&e.id?e:isNaN(e)?void 0:(KC.db.equipments||KC.db.items||{})[parseInt(e)]}},function(e,r,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return"object"===(void 0===e?"undefined":a(e))&&e.id?e:isNaN(e)?void 0:KC.db.ships[parseInt(e)]}},function(e,r,t){"use strict";var a=[82,88],i=[553],n=a.concat(i),s=[411,412],o=a.concat(s),u=[216,217].concat([547,146]),c=[488],l=[566,567,568],p=[543],h=p.concat([229]);e.exports=[{equipment:229,ship:{isClass:[84,12,92,94,108]},bonusImprove:{10:{fire:1,aa:1}}},{equipment:229,ship:{isID:c},bonusImprove:{10:{fire:2,aa:3}}},{equipment:266,ship:{isID:l},bonusCount:{1:{fire:1},2:{fire:3}}},{equipment:267,ship:{isClass:[21],isNotID:l},bonus:{fire:1,evasion:1}},{equipment:267,ship:{isClass:[22,24],isNotID:p},bonus:{fire:2,evasion:1}},{equipment:267,ship:{isID:l},bonusCount:{1:{fire:2,evasion:1},2:{fire:3,evasion:2},3:{fire:4,evasion:3}}},{equipment:267,ship:{isID:p},bonus:{fire:3,evasion:1}},{equipment:104,ship:{isID:[149]},bonus:{fire:2}},{equipment:104,ship:{isID:[151]},bonus:{fire:2,aa:1,evasion:2}},{equipment:104,ship:{isID:[150,152]},bonus:{fire:1}},{equipment:289,ship:{isID:[149]},bonus:{fire:2,aa:1}},{equipment:289,ship:{isID:[151]},bonus:{fire:2,aa:2,evasion:2}},{equipment:289,ship:{isID:[150,152]},bonus:{fire:1}},{equipment:290,ship:{isID:s},bonus:{fire:1}},{equipment:290,ship:{isID:a},bonus:{fire:2,aa:2,evasion:1}},{equipment:290,ship:{isID:i},bonus:{fire:3,aa:2,evasion:1}},{equipment:285,ship:{isID:[].concat([426,420],[195,407],[437,147],[326,419])},bonusImprove:{0:{torpedo:2,evasion:1},10:{fire:1,torpedo:2,evasion:1}}},{equipment:15,ship:{isID:l},bonusCount:{1:{torpedo:2},2:{torpedo:4}}},{equipment:286,ship:{isID:l},bonusImprove:{0:{torpedo:2,evasion:1},5:{torpedo:3,evasion:1},10:{fire:1,torpedo:3,evasion:1}}},{equipment:286,ship:{isID:[].concat([145,498,144,469],[463,468,199,489,490,198,464,470],p)},bonusImprove:{0:{torpedo:2,evasion:1},10:{fire:1,torpedo:2,evasion:1}}},{equipment:79,ship:{isID:i},bonus:{fire:3}},{equipment:79,ship:{isID:o},bonus:{fire:2}},{equipment:81,ship:{isID:i},bonus:{fire:3}},{equipment:81,ship:{isID:o},bonus:{fire:2}},{equipment:237,ship:{isID:i},bonus:{fire:4}},{equipment:237,ship:{isID:o},bonus:{fire:3}},{equipment:24,ship:{isID:i},bonus:{fire:2}},{equipment:57,ship:{isID:i},bonus:{fire:2}},{equipment:100,ship:{isID:i},bonus:{fire:4}},{equipment:291,ship:{isID:i},bonus:{fire:6,evasion:1}},{equipment:292,ship:{isID:i},bonus:{fire:8,aa:1,evasion:2}},{equipment:61,ship:{isID:i},bonus:{fire:3,armor:1,evasion:2,range:"1"}},{equipment:268,ship:{isID:u},bonusCount:{1:{armor:2,evasion:7}}},{list:[{id:229,star:10},"SurfaceRadar"],equipments:[{isID:229,improvement:10},{isSurfaceRadar:!0}],ship:{isClass:[84,12]},bonus:{fire:2,evasion:3}},{list:[{id:229,star:10},"SurfaceRadar"],equipments:[{isID:229,improvement:10},{isSurfaceRadar:!0}],ship:{isClass:[92,94,108]},bonus:{fire:1,evasion:4}},{list:[{id:229,star:10},"SurfaceRadar"],equipments:[{isID:229,improvement:10},{isSurfaceRadar:!0}],ship:{isID:c},bonus:{fire:3,evasion:2}},{list:[267,"SurfaceRadar"],equipments:{hasID:[267],hasSurfaceRadar:!0},ship:{isID:h},bonus:{fire:1,torpedo:3,evasion:2}},{list:[289,"SurfaceRadar"],equipments:{hasID:[289],hasSurfaceRadar:!0},ship:{isID:[149,150,151,152]},bonus:{fire:2,evasion:2}},{list:[290,"AARadar"],equipments:{hasID:[290],hasAARadar:!0},ship:{isID:n},bonus:{aa:2,evasion:3}}]},function(e,r,t){"use strict";var a={SmallCaliber:1,SmallCaliberHigh:2,SmallCaliberHA:2,SmallCaliberAA:3,SmallCaliberAAFD:3,MediumCaliber:4,LargeCaliber:5,SuperCaliber:6,SecondaryGun:7,SecondaryGunHigh:8,SecondaryGunHA:8,SecondaryGunAA:9,SecondaryGunAAFD:9,Type3Shell:10,APShell:11,Torpedo:12,SubmarineTorpedo:13,MidgetSubmarine:14,ReconSeaplane:15,ReconSeaplaneNight:16,SeaplaneBomber:17,CarrierFighter:18,TorpedoBomber:19,DiveBomber:20,CarrierRecon:21,Autogyro:22,AntiSubPatrol:23,SmallRadar:24,LargeRadar:25,DepthCharge:26,Sonar:27,LargeSonar:28,AAGun:29,AAGunConcentrated:30,AAGunCD:30,CDMG:30,AAFireDirector:31,AAFD:31,AviationPersonnel:36,SurfaceShipPersonnel:37,LandingCraft:38,Searchlight:39,SupplyContainer:41,CommandFacility:45,LargeFlyingBoat:45,SearchlightLarge:46,SuparRadar:47,CombatRation:48,CarrierRecon2:50,SeaplaneFighter:51,AmphibiousCraft:52,LandBasedAttacker:53,Interceptor:54,JetBomberFighter:55,JetBomberFighter2:56,TransportMaterial:57,SubmarineEquipment:58,LandBasedFighter:59,CarrierFighterNight:60,TorpedoBomberNight:61,LandBasedAntiSubPatrol:62};a.MainGuns=[a.SmallCaliber,a.SmallCaliberHigh,a.SmallCaliberAA,a.MediumCaliber,a.LargeCaliber,a.SuperCaliber],a.MainCalibers=a.MainGuns,a.SmallCalibers=[a.SmallCaliber,a.SmallCaliberHigh,a.SmallCaliberAA],a.MediumCalibers=[a.MediumCaliber],a.LargeCalibers=[a.LargeCaliber,a.SuperCaliber],a.SecondaryGuns=[a.SecondaryGun,a.SecondaryGunHigh,a.SecondaryGunAA],a.HAMounts=[a.SmallCaliberHigh,a.SmallCaliberAA,a.SecondaryGunHigh,a.SecondaryGunAA],a.HAMountsAAFD=[a.SmallCaliberAA,a.SecondaryGunAA],a.APShells=[a.APShell],a.Torpedos=[a.Torpedo,a.SubmarineTorpedo],a.Seaplanes=[a.ReconSeaplane,a.ReconSeaplaneNight,a.SeaplaneBomber,a.SeaplaneFighter],a.Fighters=[a.SeaplaneBomber,a.CarrierFighter,a.CarrierFighterNight,a.TorpedoBomber,a.TorpedoBomberNight,a.DiveBomber,a.SeaplaneFighter,a.LandBasedAttacker,a.Interceptor,a.JetBomberFighter,a.JetBomberFighter2,a.LandBasedFighter],a.Interceptors=[a.Interceptor,a.LandBasedFighter],a.Recons=[a.ReconSeaplane,a.ReconSeaplaneNight,a.CarrierRecon,a.CarrierRecon2,a.LargeFlyingBoat],a.SeaplaneRecons=[a.ReconSeaplane,a.ReconSeaplaneNight],a.SeaplaneReconsAll=[a.ReconSeaplane,a.ReconSeaplaneNight,a.LargeFlyingBoat],a.SeaplaneBombers=[a.SeaplaneBomber,a.SeaplaneFighter],a.SeaplaneFighters=[a.SeaplaneFighter],a.CarrierFighters=[a.CarrierFighter,a.CarrierFighterNight],a.CarrierRecons=[a.CarrierRecon,a.CarrierRecon2],a.CarrierBased=[a.CarrierFighter,a.CarrierFighterNight,a.TorpedoBomber,a.TorpedoBomberNight,a.DiveBomber,a.CarrierRecon,a.CarrierRecon2,a.JetBomberFighter,a.JetBomberFighter2],a.LandBased=[a.LandBasedAttacker,a.Interceptor,a.JetBomberFighter,a.JetBomberFighter2,a.LandBasedFighter,a.LandBasedAntiSubPatrol],a.TorpedoBombers=[a.TorpedoBomber,a.TorpedoBomberNight],a.DiveBombers=[a.DiveBomber],a.JetBomberFighters=[a.JetBomberFighter,a.JetBomberFighter2],a.Jets=[a.JetBomberFighter,a.JetBomberFighter2],a.Autogyros=[a.Autogyro],a.AntiSubPatrols=[a.AntiSubPatrol,a.LandBasedAntiSubPatrol],a.Aircrafts=[],[].concat(a.Seaplanes).concat(a.Recons).concat(a.CarrierBased).concat(a.Autogyros).concat(a.AntiSubPatrols).concat(a.LandBased).forEach(function(e){a.Aircrafts.indexOf(e)<0&&a.Aircrafts.push(e)}),a.Radars=[a.SmallRadar,a.LargeRadar,a.SuparRadar],a.SmallRadars=[a.SmallRadar],a.LargeRadars=[a.LargeRadar,a.SuparRadar],a.AntiSubmarines=[a.DepthCharge,a.Sonar,a.LargeSonar],a.DepthCharges=[a.DepthCharge],a.Sonars=[a.Sonar,a.LargeSonar],a.AAGuns=[a.AAGun,a.AAGunConcentrated],a.AAFireDirectors=[a.AAFireDirector],a.AAFDs=a.AAFireDirectors,a.Searchlights=[a.Searchlight,a.SearchlightLarge],a.AviationPersonnels=[a.AviationPersonnel],a.SurfaceShipPersonnels=[a.SurfaceShipPersonnel],a.LandingCrafts=[a.LandingCraft,a.AmphibiousCraft],a.AmphibiousCrafts=[a.AmphibiousCraft],a.SupplyContainers=[a.SupplyContainer],a.CombatRations=[a.CombatRation],e.exports=a},function(e,r,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var n=t(0),s=["id","name","nameof","type"];e.exports=function e(r,t,o){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("object"===(void 0===t?"undefined":a(t))&&!Array.isArray(t))return e(r,[],[],t);if("object"===(void 0===o?"undefined":a(o))&&!Array.isArray(o))return e(r,t,[],o);if(!Array.isArray(r))return e([r],t,o,u);if(Array.isArray(t)||(t=[t]),Array.isArray(o)||(o=[o]),Array.isArray(u))return u.every(function(e){return r.some(function(r,a){return n(r,t[a],o[a],e)})});var c=function(e){if(void 0===u[e])return"continue";if(!1===u[e]){if(!r.every(function(r,a){return n(r,t[a],o[a],i({},e.replace(/^has/,"is"),u[e]))}))return{v:!1}}else if(!0===u[e]){if(!r.some(function(r,a){return n(r,t[a],o[a],i({},e.replace(/^has/,"is"),u[e]))}))return{v:!1}}else if("has"===e.substr(0,3)&&s.includes(e.substr(3).toLowerCase())){if(Array.isArray(u[e])){if(!u[e].every(function(a){return r.some(function(r,s){return n(r,t[s],o[s],i({},e.replace(/^has/,"is"),a))})}))return{v:!1}}else if(!r.some(function(r,a){return n(r,t[a],o[a],i({},e.replace(/^has/,"is"),u[e]))}))return{v:!1}}else if("has"!==e.substr(0,3)||"object"!==a(u[e])||Array.isArray(u[e])){if("has"!==e.substr(0,3)||isNaN(u[e])){if("has"===e.substr(0,3)&&Array.isArray(u[e])){var c=r.filter(function(r,a){return n(r,t[a],o[a],i({},e.replace(/^has/,"is"),!0))});if(c.length<u[e][0]||c.length>u[e][1])return{v:!1}}}else if(r.filter(function(r,a){return n(r,t[a],o[a],i({},e.replace(/^has/,"is"),!0))}).length<u[e])return{v:!1}}else{var l=Object.assign({},u[e]),p=void 0===l.count?1:l.count;if(delete l.count,r.filter(function(r,a){return n(r,t[a],o[a],i({},e.replace(/^has/,"is"),l))}).length<p)return{v:!1}}};for(var l in u){var p=c(l);switch(p){case"continue":continue;default:if("object"===(void 0===p?"undefined":a(p)))return p.v}}return!0}},function(e,r,t){"use strict";e.exports=function(e,r){return Array.isArray(e)?e.every(r):r(e)}},function(e,r,t){"use strict";e.exports=function(e,r){return Array.isArray(e)?e.some(r):r(e)}},function(e,r,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=t(4),n=t(3);e.exports=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return"number"!=typeof r&&"string"!=typeof r||(r=[r]),"number"!=typeof t&&"string"!=typeof t||(t=[t]),"number"!=typeof s&&"string"!=typeof s||(s=[s]),e=i(e),r=[].concat(function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(Array(Math.max(5,e.slot.length+1)))).map(function(t,a){if(e&&!(e.slot.length<=a&&a<4))return n(r[a])||void 0}),{ship:e,equipments:r,equipmentStars:r.map(function(e,i){return"object"===a(r[i])?Math.min(10,parseInt(t[i])||0):void 0}),equipmentRanks:r.map(function(e,t){return"object"===a(r[t])?Math.min(7,parseInt(s[t])||0):void 0})}}},function(e,r,t){"use strict";var a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=t(10),s=t(2),o=t(7),u=t(5);e.exports=function e(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],p=arguments[4];if("string"==typeof c)return e(r,t,void 0,void 0,c);if("string"==typeof l)return e(r,t,c,void 0,l);var h=n(r,t,c,l);r=h.ship,t=h.equipments,c=h.equipmentStars,l=h.equipmentRanks;var f={},d=u.filter(function(e){return s(r,e.ship)}),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var r in e)void 0===f[r]?f[r]=e[r]:"number"==typeof f[r]?f[r]+=e[r]:f[r]=e[r]};return d.filter(function(e){return"number"==typeof e.equipment&&t.some(function(r){return r&&r.id&&r.id==e.equipment})}).forEach(function(e){var r={};if("object"===i(e.bonusImprove)){var n=Object.keys(e.bonusImprove).sort(function(e,r){return parseInt(r)-parseInt(e)});t.forEach(function(t,a){t&&t.id&&t.id==e.equipment&&n.some(function(t){if(c[a]>=t){for(var i in e.bonusImprove[t])void 0===r[i]?r[i]=e.bonusImprove[t][i]:"number"==typeof r[i]?r[i]+=e.bonusImprove[t][i]:r[i]=e.bonusImprove[t][i];return!0}return!1})})}else{var s=0;if(t.forEach(function(r){r&&r.id&&r.id==e.equipment&&s++}),"object"===i(e.bonusCount))Object.keys(e.bonusCount).sort(function(e,r){return parseInt(r)-parseInt(e)}).some(function(t){return s>=t&&(r=a({},e.bonusCount[t]),!0)});else if("object"===i(e.bonus))for(var o in r=a({},e.bonus))r[o]="number"==typeof r[o]?r[o]*s:parseInt(r[o])}m(r)}),d.filter(function(e){return"object"===i(e.equipments)&&o(t,c,l,e.equipments)}).forEach(function(e){m(e.bonus)}),"string"==typeof p?f[p]||0:f}},function(e,r,t){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}();function n(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function s(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}window.KC=function(){var e=t(5),r=t(11),u=t(2),c=t(0),l={lang:"zh_cn",joint:"・",maxShipLv:165,maxHqLv:120,db:{},path:{db:"/kcdb/",pics:{ships:"/kcpic/ships/"}},statSpeed:{5:"低速",10:"高速",15:"高速+",20:"最速"},getStatSpeed:function(e){return this.statSpeed[parseInt(e)]},statRange:{1:"短",2:"中",3:"长",4:"超长"},getStatRange:function(e){return this.statRange[parseInt(e)]},textRank:{1:"|",2:"||",3:"|||",4:"\\",5:"\\\\",6:"\\\\\\",7:"》"},check:{ship:u,equipment:c}},p=function(){function e(r){for(var t in o(this,e),r)this[t]=r[t]}return i(e,[{key:"getName",value:function(e){return e=e||l.lang,this.name?this.name[e]||this.name:null}},{key:"isName",value:function(e,r){if(!0===r&&(r=l.lang),r)return this.name[r]===e;for(var t in this.name)if("suffix"!==t&&this.name[t]===e)return!0;return!1}},{key:"hasName",value:function(e,r){if(!0===r&&(r=l.lang),r)return!!this.name[r].includes(e);for(var t in this.name)if("suffix"!==t&&this.name[t].includes(e))return!0;return!1}},{key:"isNameOf",value:function(){return this.hasName.apply(this,arguments)}},{key:"_name",get:function(){return this.getName()}}]),e}(),h=function(e){function r(e){return o(this,r),n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e))}return s(r,e),r}(p),f=function(r){function t(e){o(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(r,"rankupgradable",{value:r.isRankUpgradable()}),r}return s(t,r),i(t,[{key:"getName",value:function(e,r){r=r||l.lang;var t=p.prototype.getName.call(this,r),a=e&&1==!e?e:"small";return e?t.replace(/（([^（^）]+)）/g,"<"+a+">($1)</"+a+">"):t}},{key:"getType",value:function(e){return e=e||l.lang,this.type?l.db.item_types[this.type].name[e]:null}},{key:"getIconId",value:function(){return Array.isArray(this.type_ingame)&&this.type_ingame.length>3?this.type_ingame[3]:l.db.item_types[this.type].icon}},{key:"getCaliber",value:function(){var e=this.getName(!1,"ja_jp"),r=parseFloat(e);return r}},{key:"getPower",value:function(){return this.stat[l.db.item_types[this.type].main_attribute||"fire"]}},{key:"isEquipableExSlot",value:function(){return this.equipable_exslot?this.equipable_exslot||!1:this.type&&l.db.item_types[this.type].equipable_exslot||!1}},{key:"isRankUpgradable",value:function(){return S.equipmentType.Aircrafts.includes(this.type)&&this.type!==S.equipmentType.Autogyro&&this.type!==S.equipmentType.AntiSubPatrol}},{key:"getStat",value:function(e,r){e=e.toLowerCase();var t=this.stat[e];if(!r||void 0===t||!Array.isArray(this.stat_bonus))return t;if(r&&Array.isArray(this.stat_bonus)){"object"!==(void 0===r?"undefined":a(r))&&(r=l.db.ships[r]);var i=r.id,n=void 0;if(this.stat_bonus.forEach(function(e){Array.isArray(e.ships)&&e.ships.some(function(r){if(r==i){for(var t in e.bonus)n||(n={}),n[t]=Math.max(e.bonus[t],n[t]||0);return!0}return!1}),Array.isArray(e.ship_classes)&&e.ship_classes.some(function(t){if(t==r.class){for(var a in e.bonus)n||(n={}),n[a]=Math.max(e.bonus[a],n[a]||0);return!0}return!1})}),n)return t+(n[e]||0)}return t}},{key:"getBonuses",value:function(){var r=this;return e.filter(function(e){return e.equipment==r.id||(Array.isArray(e.equipments)?e.equipments.some(function(e){return c(r,10,7,e)}):"object"===a(e.equipments)&&c(r,{isID:e.equipments.hasID,isNotID:e.equipments.hasNotID}))})}},{key:"_icon",get:function(){return"assets/images/itemicon/"+this.getIconId()+".png"}}]),t}(p),d=function(r){function t(e){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return s(t,r),i(t,[{key:"getName",value:function(e,r){e=e||"",r=r||l.lang;var t=this.getSuffix(r);return(this.name[r]||this.name.ja_jp)+(t?(!0===e?l.joint:e)+t:"")}},{key:"getNameNoSuffix",value:function(e){return e=e||l.lang,this.name[e]||this.name.ja_jp}},{key:"getSuffix",value:function(e){return e=e||l.lang,this.name.suffix&&(l.db.ship_namesuffix[this.name.suffix][e]||l.db.ship_namesuffix[this.name.suffix].ja_jp)||""}},{key:"getType",value:function(e){return e=e||l.lang,this.type?l.db.ship_types[this.type].name[e]||l.db.ship_types[this.type].name.ja_jp||"":null}},{key:"getSeriesData",value:function(){return this.series?l.db.ship_series[this.series].ships:[{id:this.id}]}},{key:"getPic",value:function(e,r){var t=this.getSeriesData();e=parseInt(e||0);for(var a=function(e,t){return"undefined"!=typeof node&&node&&node.path&&l.path.pics.ships?node.path.join(l.path.pics.ships,e+"/"+t+"."+(r||"webp")):l.path.pics.ships?l.path.pics.ships+e+"/"+t+"."+(r||"png"):"/"+e+"/"+t+"."+(r||"png")},i=0;i<t.length;i++)if(t[i].id==this.id)switch(e){case 0:case 1:case 2:case 3:case 12:case 13:case 14:return a(this.id,e);default:return t[i].illust_delete?a(t[i-1].id,e):a(this.id,e)}}},{key:"getSpeed",value:function(){return l.statSpeed[parseInt(this.stat.speed)]}},{key:"getSpeedRule",value:function(){return this.speed_rule?this.speed_rule:this.class?l.db.ship_classes[this.class].speed_rule:null}},{key:"getRange",value:function(){return l.statRange[parseInt(this.stat.range)]}},{key:"getEquipmentTypes",value:function(e){var r=this.additional_disable_item_types||[],t=l.db.ship_types[this.type],a=t.equipable.concat(this.additional_item_types||[]);return"number"==typeof e&&Array.isArray(t.additional_item_types_by_slot)&&Array.isArray(t.additional_item_types_by_slot[e])&&t.additional_item_types_by_slot[e].forEach(function(e){return a.push(e)}),a.filter(function(e){return r.indexOf(e)<0}).sort(function(e,r){return e-r})}},{key:"getAttribute",value:function(e,r){(r=r||1)>t.lvlMax&&(r=t.lvlMax);var a=void 0;switch(e){case"hp":return a=this.stat.hp,r>99&&(a=this.stat.hp>=90?this.stat.hp+9:this.stat.hp>=70?this.stat.hp+8:this.stat.hp>=50?this.stat.hp+7:this.stat.hp>=40?this.stat.hp+6:this.stat.hp>=30?this.stat.hp+5:this.stat.hp+4)>this.stat.hp_max&&(a=this.stat.hp_max),a;case"speed":return l.getStatSpeed(this.stat.speed);case"range":return l.getStatRange(this.stat.range);case"luck":return r>99?this.stat.luck+3:this.stat.luck;case"fuel":case"ammo":return r>99?Math.floor(.85*this.consum[e]):this.consum[e];case"aa":case"armor":case"fire":case"torpedo":return this.stat[e+"_max"]||this.stat[e];default:return function(e,r,t){return e=e||1,r=parseFloat(r),t=parseFloat(t)||r,r<0||t<0?-1:r==t?t:Math.floor(r+(t-r)*e/99)}(r,this.stat[e],this.stat[e+"_max"])}}},{key:"getRel",value:function(e){if(e){if(!this.rels[e]&&this.remodel&&this.remodel.prev)for(var r=l.db.ships[this.remodel.prev];r;){if(r.rels&&r.rels[e])return r.rels[e];r=r.remodel&&r.remodel.prev?l.db.ships[r.remodel.prev]:null}return this.rels[e]}return this.rels}},{key:"getCV",value:function(e){var r=this.getRel("cv");if(r)return l.db.entities[r].getName(e||l.lang)}},{key:"getIllustrator",value:function(e){var r=this.getRel("illustrator");if(r)return l.db.entities[r].getName(e||l.lang)}},{key:"getMinLv",value:function(){var e=this,r=this._series,t=void 0;return r.some(function(a,i){return e.id==a.id&&(t=i?r[i-1].next_lvl:1),t}),t}},{key:"getNavy",value:function(){return this.navy?this.navy:this.class&&l.db.ship_classes[this.class].navy||"ijn"}},{key:"getCapability",value:function(e){return e?this.capabilities?this.capabilities[e]:void 0:this.capabilities||{}}},{key:"getStatExtraMax",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(e.toLowerCase()){case"hp":var t=this.getAttribute(e,r),a=this.stat.hp_max;return Math.max(0,Math.min(2,a-t));case"asw":return this.stat.asw?9:!!S.shipType.LightCruisers.concat(S.shipType.Destroyers).includes(this.type)&&9;default:return!1}}},{key:"getBonuses",value:function(){var r=this;return e.filter(function(e){return u(r,e.ship)})}},{key:"_type",get:function(){return this.getType()}},{key:"_series",get:function(){return this.getSeriesData()}},{key:"_pics",get:function(){for(var e=[],r=0;r<15;r++)e.push(this.getPic(r));return e}},{key:"_speed",get:function(){return this.getSpeed()}},{key:"_speedRule",get:function(){return this.getSpeedRule()}},{key:"_range",get:function(){return this.getRange()}},{key:"_cv",get:function(){return this.getCV()}},{key:"_illustrator",get:function(){return this.getIllustrator()}},{key:"_minLv",get:function(){return this.getMinLv()}},{key:"_navy",get:function(){return this.getNavy()}}]),t}(p);d.lvlMax=l.maxShipLv;var m=function(e){function r(e){return o(this,r),n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e))}return s(r,e),r}(p);l.dbLoad=function(e){return"string"==typeof e?l.dbLoad({type:e}):e.type||e.url?$.ajax({url:e.url||l.path.db+"/"+e.type+".json",dataType:"text",success:function(r){var t=[];e.beforeProcess&&(t=e.beforeProcess(r)),void 0===l.db[e.type]&&(l.db[e.type]={}),t.forEach(function(r){if(r){var t=JSON.parse(r);switch(e.type){case"ships":l.db[e.type][t.id]=new d(t);break;case"items":l.db[e.type][t.id]=new f(t);break;case"entities":l.db[e.type][t.id]=new h(t);break;default:l.db[e.type][t.id]=t}}}),e.success&&e.success(r)},complete:function(r,t){e.complete&&e.complete(r,t)}}):null};var g=function(e){return e instanceof d?e:l.db.ships?l.db.ships[e]:{}},b=function(e){return e instanceof f?e:l.db.equipments?l.db.equipments[e]:l.db.items[e]},y=function(e){var r=[];return e.forEach(function(e,t){r[t>=4?t+1:t]=e}),r[4]=0,r},S={equipmentType:{SmallCaliber:1,SmallCaliberHigh:2,SmallCaliberAA:3,MediumCaliber:4,LargeCaliber:5,SuperCaliber:6,SecondaryGun:7,SecondaryGunHigh:8,SecondaryGunAA:9,APShell:11,Torpedo:12,SubmarineTorpedo:13,MidgetSubmarine:14,ReconSeaplane:15,ReconSeaplaneNight:16,SeaplaneBomber:17,CarrierFighter:18,TorpedoBomber:19,DiveBomber:20,CarrierRecon:21,Autogyro:22,AntiSubPatrol:23,SmallRadar:24,LargeRadar:25,DepthCharge:26,Sonar:27,LargeSonar:28,AAGun:29,AAGunConcentrated:30,AAFireDirector:31,AviationPersonnel:36,SurfaceShipPersonnel:37,LandingCraft:38,Searchlight:39,CommandFacility:45,LargeFlyingBoat:45,SearchlightLarge:46,SuparRadar:47,CarrierRecon2:50,SeaplaneFighter:51,AmphibiousCraft:52,LandBasedAttacker:53,Interceptor:54,JetBomberFighter:55,JetBomberFighter2:56,TransportMaterial:57,SubmarineEquipment:58,LandBasedFighter:59,CarrierFighterNight:60,TorpedoBomberNight:61,LandBasedAntiSubPatrol:62},shipType:{Carriers:[9,10,11,30,32],LightCruisers:[2,3,21,28],Destroyers:[1,19],Submarines:[13,14]},calcByShip:{},calcByFleet:{},calcByField:{},calc:{}},v=S.equipmentType;return v.MainGuns=[v.SmallCaliber,v.SmallCaliberHigh,v.SmallCaliberAA,v.MediumCaliber,v.LargeCaliber,v.SuperCaliber],v.SmallCalibers=[v.SmallCaliber,v.SmallCaliberHigh,v.SmallCaliberAA],v.MediumCalibers=[v.MediumCaliber],v.LargeCalibers=[v.LargeCaliber,v.SuperCaliber],v.SecondaryGuns=[v.SecondaryGun,v.SecondaryGunHigh,v.SecondaryGunAA],v.APShells=[v.APShell],v.Torpedos=[v.Torpedo,v.SubmarineTorpedo],v.Seaplanes=[v.ReconSeaplane,v.ReconSeaplaneNight,v.SeaplaneBomber,v.SeaplaneFighter],v.Fighters=[v.SeaplaneBomber,v.CarrierFighter,v.CarrierFighterNight,v.TorpedoBomber,v.TorpedoBomberNight,v.DiveBomber,v.SeaplaneFighter,v.LandBasedAttacker,v.Interceptor,v.JetBomberFighter,v.JetBomberFighter2,v.LandBasedFighter],v.Interceptors=[v.Interceptor,v.LandBasedFighter],v.Recons=[v.ReconSeaplane,v.ReconSeaplaneNight,v.CarrierRecon,v.CarrierRecon2,v.LargeFlyingBoat],v.ReconSeaplanes=[v.ReconSeaplane,v.ReconSeaplaneNight],v.SeaplaneRecons=[v.ReconSeaplane,v.ReconSeaplaneNight,v.LargeFlyingBoat],v.SeaplaneBombers=[v.SeaplaneBomber,v.SeaplaneFighter],v.SeaplaneFighters=[v.SeaplaneFighter],v.CarrierFighters=[v.CarrierFighter,v.CarrierFighterNight],v.CarrierRecons=[v.CarrierRecon,v.CarrierRecon2],v.CarrierBased=[v.CarrierFighter,v.CarrierFighterNight,v.TorpedoBomber,v.TorpedoBomberNight,v.DiveBomber,v.CarrierRecon,v.CarrierRecon2,v.JetBomberFighter,v.JetBomberFighter2],v.LandBased=[v.LandBasedAttacker,v.Interceptor,v.JetBomberFighter,v.JetBomberFighter2,v.LandBasedFighter,v.LandBasedAntiSubPatrol],v.TorpedoBombers=[v.TorpedoBomber,v.TorpedoBomberNight],v.DiveBombers=[v.DiveBomber],v.JetBomberFighters=[v.JetBomberFighter,v.JetBomberFighter2],v.Autogyros=[v.Autogyro],v.AntiSubPatrols=[v.AntiSubPatrol,v.LandBasedAntiSubPatrol],v.Aircrafts=[],[].concat(v.Seaplanes).concat(v.Recons).concat(v.CarrierBased).concat(v.Autogyros).concat(v.AntiSubPatrols).concat(v.LandBased).forEach(function(e){v.Aircrafts.indexOf(e)<0&&v.Aircrafts.push(e)}),v.Radars=[v.SmallRadar,v.LargeRadar,v.SuparRadar],v.SmallRadars=[v.SmallRadar],v.LargeRadars=[v.LargeRadar,v.SuparRadar],v.AntiSubmarines=[v.DepthCharge,v.Sonar,v.LargeSonar],v.DepthCharges=[v.DepthCharge],v.Sonars=[v.Sonar,v.LargeSonar],v.AAGuns=[v.AAGun,v.AAGunConcentrated],v.AAFireDirectors=[v.AAFireDirector],v.Searchlights=[v.Searchlight,v.SearchlightLarge],v.AviationPersonnels=[v.AviationPersonnel],v.SurfaceShipPersonnels=[v.SurfaceShipPersonnel],v.LandingCrafts=[v.LandingCraft,v.AmphibiousCraft],v.AmphibiousCrafts=[v.AmphibiousCraft],v.isInterceptor=function(e){return(!(e=b(e)).type_ingame||47!=e.type_ingame[2])&&v.Interceptors.indexOf(e.type)>-1},S.starMultiper={SmallCalibers:{shelling:1,night:1},MediumCalibers:{shelling:1,night:1},LargeCalibers:{shelling:1.5,night:1},SecondaryGuns:{shelling:1,night:1,hit:1},APShells:{shelling:1,night:1},AAFireDirectors:{shelling:1,night:1},Searchlights:{shelling:1,night:1},AAGuns:{shelling:1,torpedo:1.2},Torpedos:{torpedo:1.2,night:1},DepthCharges:{shelling:.75,antisub:1},Sonars:{shelling:.75,antisub:1},SmallRadars:{los:1.25},LargeRadars:{los:1.4},Seaplanes:{},ReconSeaplanes:{los:1.2},SeaplaneFighters:{fighter:.2},SeaplaneBomber:{los:1.15},CarrierFighters:{fighter:.2},DiveBombers:{fighter:.25,night:1},CarrierRecons:{los:1.2},LandingCrafts:{shelling:1,night:1},Interceptors:{fighter:.2},_10:{shelling:["multiplication",.2],night:1},_66:{shelling:["multiplication",.2],night:1},_220:{shelling:["multiplication",.2],night:1},_275:{shelling:["multiplication",.2],night:1},_12:{shelling:["multiplication",.3],night:["multiplication",.3]},_234:{shelling:["multiplication",.3],night:["multiplication",.3]}},S.getStarMultiplier=function(e,r){if(!S.starMultiper._init){var t=function(e){v[e]&&v[e].forEach?v[e].forEach(function(r){S.starMultiper[r]=S.starMultiper[e]}):"number"==typeof v[e]&&(S.starMultiper[v[e]]=S.starMultiper[e])};for(var a in S.starMultiper)t(a);S.starMultiper._init=!0}var i=S.starMultiper[e]||{};return r?i[r]||0:i},S.getStarBonus=function(e,r,t){e=b(e);var a=Object.assign({},S.getStarMultiplier(e.type),S.starMultiper["_"+e.id])[r],i=void 0===a?0:a,n="sqrt";switch(Array.isArray(i)&&(n=i[0],i=i[1]),n){case"sqrt":return i*Math.sqrt(t);case"multiplication":case"multiple":return i*t}},S.getFighterPowerRankMultiper=function(e,r){e=b(e);var t=[],a={};t[0]=[0,9],t[1]=[10,24],t[2]=[25,39],t[3]=[40,54],t[4]=[55,69],t[5]=[70,84],t[6]=[85,99],t[7]=[100,120],a.CarrierFighter=[0,0,2,5,9,14,14,22],a.SeaplaneBomber=[0,0,1,1,1,3,3,6];var i=t[r],n=0;switch(e.type){case v.CarrierFighter:case v.CarrierFighterNight:case v.Interceptor:case v.SeaplaneFighter:case v.LandBasedFighter:n=a.CarrierFighter[r];break;case v.SeaplaneBomber:n=a.SeaplaneBomber[r]}return{min:Math.sqrt(i[0]/10)+n,max:Math.sqrt(i[1]/10)+n}},S.calculate=function(e,t,a,i,n,s){if(!e||!t)return 0;t instanceof d||(t=l.db.ships[t]);var o=0,u={main:0,secondary:0,torpedo:0,torpedoLateModel:0,seaplane:0,apshell:0,radar:0,radarAA:0,radarSurface:0,submarineEquipment:0,carrierFighterNight:0,torpedoBomberNight:0,aviationPersonnelNight:0,surfaceShipPersonnel:0},c=y(t.slot),p=0;a=a.map(function(e){return e?e instanceof f?e:l.db.equipments?l.db.equipments[e]:l.db.items[e]:null})||[],i=i||[],n=n||[],s=s||{},a.forEach(function(e){e&&(v.MainGuns.indexOf(e.type)>-1?u.main+=1:v.SecondaryGuns.indexOf(e.type)>-1?u.secondary+=1:v.Torpedos.indexOf(e.type)>-1?(u.torpedo+=1,e.name.ja_jp.indexOf("後期型")>-1&&(u.torpedoLateModel+=1)):v.Seaplanes.indexOf(e.type)>-1?u.seaplane+=1:v.APShells.indexOf(e.type)>-1?u.apshell+=1:v.Radars.indexOf(e.type)>-1?(u.radar+=1,e.stat.aa&&(u.radarAA+=1),e.stat.hit&&e.stat.hit>=3&&(u.radarSurface+=1)):v.SubmarineEquipment==e.type?u.submarineEquipment+=1:v.AviationPersonnels.indexOf(e.type)>-1?e.name.ja_jp.indexOf("夜間")>-1&&(u.aviationPersonnelNight+=1):v.SurfaceShipPersonnels.indexOf(e.type)>-1&&(u.surfaceShipPersonnel+=1),e.type_ingame&&(45===e.type_ingame[3]?u.carrierFighterNight+=1:46===e.type_ingame[3]&&(u.torpedoBomberNight+=1)))});var h=r(t,a,i,n);switch(e){case"fighterPower":return p=0,c.map(function(e,r){if(a[r]&&v.Fighters.indexOf(a[r].type)>-1&&e){if(p=Math.sqrt(e)*(a[r].getStat("aa",t)||0),v.CarrierFighters.includes(a[r].type))switch(n[r]){case 1:case"1":p+=1;break;case 2:case"2":p+=4;break;case 3:case"3":p+=6;break;case 4:case"4":p+=11;break;case 5:case"5":p+=16;break;case 6:case"6":p+=17;break;case 7:case"7":p+=25}else if(-1==v.Recons.indexOf(a[r].type)){var i=a[r].type==v.SeaplaneBomber?9:3;p+=1==n[r]?1:i/6*(n[r]-1)}o+=Math.floor(p)}}),o;case"fighterPower_v2":return S.calcByShip.fighterPower_v2(t,a,i,n);case"shelling":case"shellingDamage":return S.shipType.Submarines.indexOf(t.type)>-1?"-":(o=S.calcByShip.shellingPower(t,a,i,n,{},h))&&o>-1?Math.floor(o):"-";case"torpedo":case"torpedoDamage":return(o=function(e){return S.calcByShip.torpedoPower(t,a,i,n,e,h)}())&&o>-1?Math.floor(o):"-";case"nightBattle":var m=S.calcByShip.nightPower(t,a,i,n,{},u,h);return m.damage<=0?"-":m.value;case"addHit":return c.map(function(e,r){a[r]&&(o+=a[r].getStat("hit",t)||0)}),(o+=h.hit||0)>=0?"+"+o:o;case"addArmor":return c.map(function(e,r){a[r]&&(o+=a[r].getStat("armor",t)||0)}),o+(h.armor||0);case"addEvasion":return c.map(function(e,r){a[r]&&(o+=a[r].getStat("evasion",t)||0)}),o+(h.evasion||0);case"losPower":return S.calcByShip.losPower(t,a,i,n,s);default:return S.calcByShip[e](t,a,i,n,s,h)}},S.shellingDamage=function(e,r,t,a){return this.calculate("shellingDamage",e,r,t,a)},S.torpedoDamage=function(e,r,t,a){return this.calculate("torpedoDamage",e,r,t,a)},S.fighterPower=function(e,r,t,a){return this.calculate("fighterPower",e,r,t,a)},S.fighterPower_v2=function(e,r,t,a){return this.calculate("fighterPower_v2",e,r,t,a)},S.nightBattle=function(e,r,t,a){return this.calculate("nightBattle",e,r,t,a)},S.addHit=function(e,r,t,a){return this.calculate("addHit",e,r,t,a)},S.addArmor=function(e,r,t,a){return this.calculate("addArmor",e,r,t,a)},S.addEvasion=function(e,r,t,a){return this.calculate("addEvasion",e,r,t,a)},S.losPower=function(e,r,t,a,i){return this.calculate("losPower",e,r,t,a,i)},S.calc.losPower=function(e){var r=["(Intercept)","DiveBombers","TorpedoBombers","CarrierRecons","SeaplaneRecons","SeaplaneBombers","SmallRadars","LargeRadars","Searchlights","statLos","hqLv"],t={"(Intercept)":0,DiveBombers:1.03745043134563,TorpedoBombers:1.3679056374142,CarrierRecons:1.65940512636315,SeaplaneRecons:2,SeaplaneBombers:1.77886368594467,SmallRadars:1.0045778494921,LargeRadars:.990738063979571,Searchlights:.906965144360512,statLos:1.6841895400986,hqLv:-.614246711531445},a={"(Intercept)":4.66445565766347,DiveBombers:.0965028505325845,TorpedoBombers:.108636184978525,CarrierRecons:.0976055279516298,SeaplaneRecons:.0866229392463539,SeaplaneBombers:.0917722496848294,SmallRadars:.0492773648320346,LargeRadars:.0491221486053861,Searchlights:.0658283797225724,statLos:.0781594211213618,hqLv:.0369222352426548},i={"(Intercept)":{"(Intercept)":1,DiveBombers:-.147020064768061,TorpedoBombers:-.379236131621529,CarrierRecons:-.572858669501918,SeaplaneRecons:-.733913857017495,SeaplaneBombers:-.642621825152428,SmallRadars:-.674829588068364,LargeRadars:-.707418111752863,Searchlights:-.502304601556193,statLos:-.737374218573832,hqLv:-.05071933950163},DiveBombers:{"(Intercept)":-.147020064768061,DiveBombers:1,TorpedoBombers:.288506347076736,CarrierRecons:.365820372770994,SeaplaneRecons:.425744409856409,SeaplaneBombers:.417783698791503,SmallRadars:.409046013184429,LargeRadars:.413855653833994,Searchlights:.308730607324667,statLos:.317984916914851,hqLv:-.386740224500626},TorpedoBombers:{"(Intercept)":-.379236131621529,DiveBombers:.288506347076736,TorpedoBombers:1,CarrierRecons:.482215071254241,SeaplaneRecons:.584455876852325,SeaplaneBombers:.558515133495825,SmallRadars:.547260012897553,LargeRadars:.560437619378443,Searchlights:.437934879351188,statLos:.533934507932748,hqLv:-.405349979885748},CarrierRecons:{"(Intercept)":-.572858669501918,DiveBombers:.365820372770994,TorpedoBombers:.482215071254241,CarrierRecons:1,SeaplaneRecons:.804494553748065,SeaplaneBombers:.75671307047535,SmallRadars:.748420581669228,LargeRadars:.767980338133817,Searchlights:.589651513349878,statLos:.743851348255527,hqLv:-.503544281376776},SeaplaneRecons:{"(Intercept)":-.733913857017495,DiveBombers:.425744409856409,TorpedoBombers:.584455876852325,CarrierRecons:.804494553748065,SeaplaneRecons:1,SeaplaneBombers:.932444440578382,SmallRadars:.923988080549326,LargeRadars:.94904944359066,Searchlights:.727912987329348,statLos:.944434077970518,hqLv:-.614921413821462},SeaplaneBombers:{"(Intercept)":-.642621825152428,DiveBombers:.417783698791503,TorpedoBombers:.558515133495825,CarrierRecons:.75671307047535,SeaplaneRecons:.932444440578382,SeaplaneBombers:1,SmallRadars:.864289865445084,LargeRadars:.886872388674911,Searchlights:.68310647756898,statLos:.88122333327317,hqLv:-.624797255805045},SmallRadars:{"(Intercept)":-.674829588068364,DiveBombers:.409046013184429,TorpedoBombers:.547260012897553,CarrierRecons:.748420581669228,SeaplaneRecons:.923988080549326,SeaplaneBombers:.864289865445084,SmallRadars:1,LargeRadars:.872011318623459,Searchlights:.671926570242336,statLos:.857213501657084,hqLv:-.560018086758868},LargeRadars:{"(Intercept)":-.707418111752863,DiveBombers:.413855653833994,TorpedoBombers:.560437619378443,CarrierRecons:.767980338133817,SeaplaneRecons:.94904944359066,SeaplaneBombers:.886872388674911,SmallRadars:.872011318623459,LargeRadars:1,Searchlights:.690102027588321,statLos:.883771367337743,hqLv:-.561336967269448},Searchlights:{"(Intercept)":-.502304601556193,DiveBombers:.308730607324667,TorpedoBombers:.437934879351188,CarrierRecons:.589651513349878,SeaplaneRecons:.727912987329348,SeaplaneBombers:.68310647756898,SmallRadars:.671926570242336,LargeRadars:.690102027588321,Searchlights:1,statLos:.723228553177704,hqLv:-.518427865593732},statLos:{"(Intercept)":-.737374218573832,DiveBombers:.317984916914851,TorpedoBombers:.533934507932748,CarrierRecons:.743851348255527,SeaplaneRecons:.944434077970518,SeaplaneBombers:.88122333327317,SmallRadars:.857213501657084,LargeRadars:.883771367337743,Searchlights:.723228553177704,statLos:1,hqLv:-.620804120587684},hqLv:{"(Intercept)":-.05071933950163,DiveBombers:-.386740224500626,TorpedoBombers:-.405349979885748,CarrierRecons:-.503544281376776,SeaplaneRecons:-.614921413821462,SeaplaneBombers:-.624797255805045,SmallRadars:-.560018086758868,LargeRadars:-.561336967269448,Searchlights:-.518427865593732,statLos:-.620804120587684,hqLv:1}},n={DiveBombers:0,TorpedoBombers:0,CarrierRecons:0,SeaplaneRecons:0,SeaplaneBombers:0,SmallRadars:0,LargeRadars:0,Searchlights:0,statLos:1,hqLv:1};for(var s in e)n[s]=e[s];return function(e){void 0===e["(Intercept)"]&&(e["(Intercept)"]=1),e.hqLv=5*Math.ceil(e.hqLv/5);var n={},s=0,o={},u=0;return r.forEach(function(r){var i=e[r]*t[r];n[r]=i,s+=i,o[r]=e[r]*a[r]}),r.forEach(function(e){r.forEach(function(r){u+=o[e]*o[r]*i[e][r]})}),{x_estimate:n,y_estimate:s,x_std_error:o,y_std_error:u}}(n)},S.calc.los33=function(e){if(e){var r=0,t=0,a={TorpedoBombers:.8,CarrierRecons:1,ReconSeaplane:1.2,ReconSeaplaneNight:1.2,SeaplaneBomber:1.1};return Object.defineProperty(a,"default",{value:.6,enumerable:!1,configurable:!1,writable:!1}),e.equipments.forEach(function(e){if(e.id){var t=b(e.id);if(t.stat.los){var i=a.default,n=e.star||0;for(var s in a)(Array.isArray(v[s])?v[s]:[v[s]]).indexOf(t.type)>-1&&(i=a[s]);r+=i*(t.stat.los+S.getStarBonus(t,"los",n))}}}),e.ships.forEach(function(e){var r=g(e.id),a=r.getAttribute("los",Math.max(e.lv||1,r.getMinLv()));t+=Math.sqrt(Math.max(a,1))}),r+t-Math.ceil(.4*e.hq)+2*(6-e.ships.length)}},S.calc.TP=function(e){var r=0,t=(e=e||{}).ship||{},a=e.equipment||{};for(var i in t){var n=0;switch(i){case 1:case"1":case 19:case"19":case"dd":n=5;break;case 2:case"2":case 28:case"28":case"cl":n=2;break;case 21:case"21":case"ct":n=6;break;case 5:case"5":case"cav":n=4;break;case 8:case"8":case"bbv":n=7;break;case 12:case"12":case 24:case"24":case"av":n=9.5;break;case 14:case"14":case"ssv":n=1;break;case 15:case"15":case"lha":n=12;break;case 29:case"29":case"ao":n=15;break;case 17:case"17":case"as":n=7}r+=n*(parseInt(t[i])||0)}for(var s in a){var o=0,u=parseInt(s),c=void 0;switch(u){case 145:case 150:o=1;break;case 75:o=5;break;case 68:case 193:case 166:o=8;break;case 167:o=2;break;default:switch((c=b(u)).type){case S.equipmentType.LandingCraft:c.name.ja_jp.indexOf("大発動艇")>-1&&(o=8)}}r+=o*(parseInt(a[s])||0)}return r},S.calc.fighterPower=function(e,r,t,a){if(!e)return[0,0];e=e instanceof f?e:l.db.equipments?l.db.equipments[e]:l.db.items[e],r=r||0,t=t||0,a=a||0;var i=[0,0];if(v.Fighters.indexOf(e.type)>-1&&r){var n=((e.stat.aa||0)+(v.isInterceptor(e)?1.5*e.stat.evasion:0)+a*S.getStarMultiplier(e.type,"fighter"))*Math.sqrt(r),s=S.getFighterPowerRankMultiper(e,t);i[0]+=Math.floor(n+s.min),i[1]+=Math.floor(n+s.max)}return i},S.calc.fighterPowerAA=function(e,r,t,a){if(!e)return[0,0];e=b(e),r=r||0,t=t||0,a=a||0;var i=[0,0];if(r){var n=((e.stat.aa||0)+(v.isInterceptor(e)?e.stat.evasion:0)+(v.isInterceptor(e)?2*e.stat.hit:0)+a*S.getStarMultiplier(e.type,"fighter"))*Math.sqrt(r),s=S.getFighterPowerRankMultiper(e,t,{isAA:!0});i[0]+=Math.floor(n+s.min),i[1]+=Math.floor(n+s.max)}return i},S.calcByShip.shellingPower=function(e,t,a,i,n,s){n=n||{},s=s||r(e,t,a,i);var o=0,u=!1,c=y(e.slot);if(S.shipType.Carriers.indexOf(e.type)>-1?u=!0:[33].includes(e.type)||t.some(function(e){if(e&&!u&&v.CarrierBased.indexOf(e.type)>-1)return u=!0,!0}),u&&!n.isNight){var l=0,p=0;return c.map(function(r,i){if(t[i]){var n=t[i];o+=1.5*n.getStat("fire",e)||0,v.TorpedoBombers.indexOf(n.type)>-1&&(l+=n.getStat("torpedo",e)||0),p+=n.getStat("bomb",e)||0,v.SecondaryGuns.indexOf(n.type)>-1&&(o+=Math.sqrt(1.5*(a[i]||0)))}}),l||p?o+=Math.floor(1.5*(Math.floor(1.3*p)+l+e.stat.fire_max+(s.fire||0)))+50:-1}o=e.stat.fire_max||0;var h={CLMainGunNaval:0,CLMainGunTwin:0,ItalianCAMainGun:0};c.map(function(r,i){if(t[i]){var s=t[i];o+=s.getStat("fire",e)||0,S.shipType.LightCruisers.indexOf(e.type)>-1&&(["14cm単装砲","15.2cm単装砲"].forEach(function(e){s.name.ja_jp.includes(e)&&(h.CLMainGunNaval+=1)}),["14cm連装砲","15.2cm連装砲"].forEach(function(e){s.name.ja_jp.includes(e)&&(h.CLMainGunTwin+=1)})),"rm"===e._navy&&s.name.ja_jp.includes("203mm/53")&&(h.ItalianCAMainGun+=1),a[i]&&!n.isNight&&(o+=S.getStarBonus(s,"shelling",a[i]))}});var f=0+2*Math.sqrt(h.CLMainGunTwin)+Math.sqrt(h.CLMainGunNaval)+Math.sqrt(h.ItalianCAMainGun)+(s.fire||0);return o+f},S.calcByShip.torpedoPower=function(e,t,a,i,n,s){n=n||{},s=s||r(e,t,a,i);var o=0,u=y(e.slot);return S.shipType.Carriers.indexOf(e.type)>-1&&!n.isNight?n.returnZero?0:-1:(o=(e.stat.torpedo_max||0)+(s.torpedo||0),u.map(function(r,i){if(t[i]){var s=t[i];o+=v.TorpedoBombers.indexOf(s.type)>-1&&!n.isNight?0:s.getStat("torpedo",e)||0,a[i]&&!n.isNight&&(o+=S.getStarBonus(s,"torpedo",a[i]))}}),o)},S.calcByShip.nightPower=function(e,t,a,i,n,s,o){n=n||{},o=o||r(e,t,a,i);var u={damage:0},c=0,l=y(e.slot);if((s.aviationPersonnelNight||e.getCapability("count_as_night_operation_aviation_personnel"))&&(s.carrierFighterNight>=1||s.torpedoBomberNight>=1)){l.forEach(function(e,r){t[r]&&a[r]&&(c+=S.getStarBonus(t[r],"night",a[r]))});var p=0,h=0,f=0,d=0,m=0,g=[],b=0,A=0;l.forEach(function(r,i){if(t[i]){var n=t[i],s=!1,o=!1;n.type_ingame&&(45===n.type_ingame[3]?(o=!0,s=!0):46===n.type_ingame[3]&&(o=!0,s=!0)),v.TorpedoBombers.indexOf(n.type)>-1?n.hasName("Swordfish","ja_jp")&&(o=!0,b++):v.DiveBombers.indexOf(n.type)>-1&&n.hasName("岩井","ja_jp")&&(o=!0,A++),s&&(p+=r),o&&(h+=n.getStat("fire",e),f+=n.getStat("torpedo",e),d+=Math.sqrt(r)*((3+1.5*(s?1:0))*(n.getStat("fire",e)+n.getStat("torpedo",e)+n.getStat("bomb",e)+n.getStat("asw",e))/10),a[i]&&(m+=S.getStarBonus(t[i],"night",a[i])))}});var C=b+A;s.carrierFighterNight>=2&&s.torpedoBomberNight>=1&&g.push(1.25),s.carrierFighterNight>=1&&s.torpedoBomberNight>=1&&g.push(1.2),(s.carrierFighterNight>=3||s.carrierFighterNight>=2&&C>=1||s.carrierFighterNight>=1&&s.torpedoBomberNight>=1&&C>=1||s.carrierFighterNight>=1&&s.torpedoBomberNight>=2||s.carrierFighterNight>=1&&C>=2)&&g.push(1.18),u.type="航空",u.hit=1,u.damage=Math.floor(e.stat.fire_max+(o.fire||0)+h+f+3*p+d+m),u.isMax=!0,g.length&&(u.cis=g.map(function(e){return[Math.floor(u.damage*e),1]}))}else if(e.getCapability("participate_night_battle_when_equip_swordfish"))u.damage+=e.stat.fire_max+(o.fire||0)+e.stat.torpedo_max+(o.torpedo||0),l.forEach(function(r,a){var i=t[a];t[a]&&v.TorpedoBombers.indexOf(i.type)>-1&&i.name.ja_jp.indexOf("Swordfish")>-1&&(u.damage+=i.getStat("fire",e)+i.getStat("torpedo",e))}),u.type="通常",u.damage=Math.floor(u.damage),u.hit=1;else{if(e.stat.fire+e.stat.torpedo<=0)return{damage:0};var B={};l.forEach(function(e,r){if(t[r]&&(a[r]&&(c+=S.getStarBonus(t[r],"night",a[r])),t[r])){var i=t[r];B[i.id]?B[i.id]++:B[i.id]=1}}),u.damage=S.calcByShip.shellingPower(e,t,a,i,{isNight:!0},o)+S.calcByShip.torpedoPower(e,t,a,i,{isNight:!0,returnZero:!0},o)+c,S.shipType.Submarines.indexOf(e.type)>-1&&s.torpedoLateModel>=1&&s.submarineEquipment>=1?(u.type="雷击CI",u.damage=Math.floor(1.75*u.damage),u.hit=2):S.shipType.Submarines.indexOf(e.type)>-1&&s.torpedoLateModel>=2?(u.type="雷击CI",u.damage=Math.floor(1.6*u.damage),u.hit=2):s.torpedo>=2?(u.type="雷击CI",u.damage=Math.floor(1.5*u.damage),u.hit=2):s.main>=3?(u.type="炮击CI",u.damage=Math.floor(2*u.damage),u.hit=1):2==s.main&&s.secondary>=1?(u.type="炮击CI",u.damage=Math.floor(1.75*u.damage),u.hit=1):S.shipType.Destroyers.indexOf(e.type)>-1&&s.torpedo>=1&&s.radarSurface>=1&&s.surfaceShipPersonnel>=1?(u.type="电探CI",u.damage=Math.floor(1.25*u.damage),u.hit=1):S.shipType.Destroyers.indexOf(e.type)>-1&&s.torpedo>=1&&s.radarSurface>=1&&s.main>=1?(u.type="电雷CI",u.damage=B[267]?Math.floor(1.625*u.damage):Math.floor(1.3*u.damage),u.hit=1):s.main>=1&&1==s.torpedo?(u.type="炮雷CI",u.damage=Math.floor(1.3*u.damage),u.hit=2):2==s.main&&s.secondary<=0&&s.torpedo<=0||1==s.main&&s.secondary>=1&&s.torpedo<=0||0==s.main&&s.secondary>=2&&s.torpedo>=0?(u.type="连击",u.damage=Math.floor(1.2*u.damage),u.hit=2):(u.type="通常",u.damage=Math.floor(u.damage),u.hit=1)}var R=" ";if(u.isMax&&(R=" ≤ "),u.isMin&&(R=" ≥ "),u.value=""+u.type+R+u.damage,u.hit&&u.hit>1&&(u.value+=" x "+u.hit),Array.isArray(u.cis)&&u.cis.length)u.value+=" (CI"+R+u.cis.sort(function(e,r){return e[0]-r[0]}).map(function(e){return e[0]+(e[1]&&e[1]>1?" x "+e[1]:"")}).join(" 或 ")+")";else if(u.damage_ci){var L=u.hit_ci||u.hit||1;u.value+=" (CI"+R+u.damage_ci+")",L&&L>1&&(u.value+=" x "+L)}return u},S.calcByShip.fighterPower_v2=function(e,r,t,a){var i=[0,0];return y(e.slot).map(function(e,n){var s=S.calc.fighterPower(r[n],e,a[n]||0,t[n]||0);i[0]+=s[0],i[1]+=s[1]}),i},S.calcByShip.losPower=function(e,r,t,a,i){(i=i||{}).shipLv=i.shipLv||1,i.hqLv=i.hqLv||1,i.shipLv<0&&(i.shipLv=1),i.hqLv<0&&(i.hqLv=1);var n={DiveBombers:0,TorpedoBombers:0,CarrierRecons:0,SeaplaneRecons:0,SeaplaneBombers:0,SmallRadars:0,LargeRadars:0,Searchlights:0,statLos:Math.sqrt(e.getAttribute("los",i.shipLv)),hqLv:i.hqLv};return r.forEach(function(e){if(e)for(var r in n)v[r]&&v[r].push&&v[r].indexOf(e.type)>-1&&(n[r]+=e.stat.los)}),S.calc.losPower(n)},S.calcByShip.TP=function(e,r){if(!e||!r||!r.push)return 0;e=g(e);var t={ship:{},equipment:{}};return t.ship[e.type]=1,r.forEach(function(e){if(e){var r="number"==typeof e?e:b(e).id;t.equipment[r]||(t.equipment[r]=0),t.equipment[r]++}}),e.getCapability("count_as_landing_craft")&&(t.equipment[68]||(t.equipment[68]=0),t.equipment[68]++),S.calc.TP(t)},S.calcByShip.speed=function(e,r,t,i,n){if(!e)return"";if("object"===(void 0===t?"undefined":a(t))&&t.push)return S.calcByShip.speed(e,r,[],[],t);if("object"===(void 0===i?"undefined":a(i))&&i.push)return S.calcByShip.speed(e,r,t,[],i);e=g(e),r=r||[],n=n||{};var s=parseInt(e.stat.speed),o=function(e){return e=Math.min(20,e||s),n.returnNumber?e:l.statSpeed[e]},u={33:0,34:0,87:0},c=e._speedRule||"low-2",p=0;if(r.forEach(function(e){if(e){var r="number"==typeof e?e:b(e).id;void 0!==u[""+r]&&u[""+r]++}}),!u[33])return o();switch(c){case"low-1":p=.3*Math.min(u[34],1)+.7*u[87];break;case"low-2":case"high-3":(u[34]||u[87])&&(p=Math.min(1,u[34]/3+.5*u[87]));break;case"low-3":case"high-4":(u[34]||u[87])&&(s+=5);break;case"high-1":p=.5*u[34]+1*u[87];break;case"high-2":p=.5*u[34]+.5*u[87];break;case"low-4":p=.5}return p>0&&p<1?s+=5:p>=1&&p<1.5?s+=10:p>=1.5&&(s+=15),o()},S.calcByShip.fireRange=function(e,t,a,i,n,s){if(!e)return"-";t=t||[],n=n||{},s=s||r(e,t,a,i);var o=parseInt(e.stat.range);return t.forEach(function(e){e&&(o=Math.max(o,b(e).stat.range||0))}),isNaN(s.range)||(o+=parseInt(s.range)),l.statRange[Math.min(4,o)]},S.calcByFleet.los33=function(e,r){var t=[],a=[];return e.forEach(function(e){if(Array.isArray(e)){var r=e[0];if(r){var i=e[2],n=e[3],s=e[4];a.push({id:r,lv:e[1][0]}),i.forEach(function(e,r){t.push({id:e,star:n[r],rank:s[r]})})}}}),S.calc.los33({hq:r,equipments:t,ships:a})},S.calcByField.fighterPowerAA=function(e){var r=[0,0],t=1;function a(e){return t=Math.max(e,t)}return e.forEach(function(e){var t=b(e[0]||e.equipment||e.equipmentId),i=e[1]||e.star||0,n=e[2]||e.rank||0,s=e[3]||e.carry||0,o=S.calc.fighterPowerAA(t,s,n,i);switch(s||(s=S.equipmentType.Recons.indexOf(t.type)>-1?4:18),r[0]+=o[0],r[1]+=o[1],t.type){case v.CarrierRecon:case v.CarrierRecon2:t.stat.los<=7?a(1.2):t.stat.los>=9?a(1.3):a(1.25);break;case v.ReconSeaplane:case v.ReconSeaplaneNight:case v.LargeFlyingBoat:t.stat.los<=7?a(1.1):t.stat.los>=9?a(1.16):a(1.13)}}),r[0]=r[0]*t,r[1]=r[1]*t,r},S.getBonus=function(e,t,a,i,n){return r(e,t,a,i,n)},Array.prototype.indexOf||(Array.prototype.indexOf=function(e,r){var t;if(null==this)throw new TypeError('"this" is null or not defined');var a=Object(this),i=a.length>>>0;if(0===i)return-1;var n=+r||0;if(Math.abs(n)===1/0&&(n=0),n>=i)return-1;for(t=Math.max(n>=0?n:i-Math.abs(n),0);t<i;){if(t in a&&a[t]===e)return t;t++}return-1}),l.Entity=h,l.Equipment=f,l.Ship=d,l.Consumable=m,l.formula=S,l}()}]);